/**
 * Minified by jsDelivr using Terser v5.14.1.
 * Original file: /npm/ganja.js@1.0.199/ganja.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t,r){"undefined"!=typeof module&&module.exports?module.exports=r():"function"==typeof define&&define.amd?define(e,r):t[e]=r()}("Algebra",this,(function(){function QR(e){const{abs:t,sqrt:r}=Math,[a,n]=[e.length,e[0].length];var o,i,l,c,h,m,u=e.map((e=>e.map((e=>e)))),p=e.map((e=>e.map((e=>0)))),f=e.map((e=>e.map((e=>0)))),d=[];for(o=0;o<n;++o){for(i=o,c=0;i<a;++i)h=c,m=u[i][o],c=t(h)>t(m)?t(h)*r(1+(m/h)**2):0==m?0:t(m)*r(1+(h/m)**2);if(c){for(u[o][o]<0&&(c=-c),i=o;i<a;++i)u[i][o]=u[i][o]/c;for(u[o][o]=u[o][o]+1,l=o+1;l<n;++l){for(i=o,s=0;i<a;++i)s+=u[i][o]*u[i][l];for(s=-s/u[o][o],i=o;i<a;++i)u[i][l]+=s*u[i][o]}}d[o]=-c}for(o=n-1;o>=0;--o){for(i=0;i<a;++i)p[i][o]=0;for(p[o][o]=1,l=o;l<n;++l)if(u[o][o]){for(i=o,s=0;i<a;++i)s+=u[i][o]*p[i][l];for(s=-s/u[o][o],i=o;i<a;++i)p[i][l]+=s*u[i][o]}}for(i=0;i<n;++i)for(l=0;l<n;++l)f[i][l]=i<l?u[i][l]:i==l?d[i]:0;return[p,f]}function eigenValues(e,t=50){const r=(e,t)=>{var r=e.map((e=>e.map((e=>0))));for(let a=0;a<e.length;++a)for(let n=0;n<t.length;++n)for(let o=0;o<t[0].length;++o)r[a][o]+=e[a][n]*t[n][o];return r};for(var a=0;a<t;++a){var[n,o]=QR(e);e=r(o,n)}return e.map(((t,r)=>e[r][r]))}return function Algebra(p,q,r){var fu=arguments[arguments.length-1],options=p;options instanceof Object?(q=0|(p.q||p.metric&&p.metric.filter((e=>-1==e)).length),r=0|(p.r||p.metric&&p.metric.filter((e=>0==e)).length),p=void 0===p.p?p.metric&&p.metric.filter((e=>1==e)).length||0:p.p||0):(options={},p|=0,r|=0,q|=0),(options.dual||0==p&&0==q&&r<0)&&(r=options.dual=options.dual||-r,options.basis=[...Array(r+1)].map(((e,t)=>t?"e0"+t:"1")),options.metric=[1,...Array(r)],options.tot=r+1,options.Cayley=[...Array(r+1)].map(((e,t)=>[...Array(r+1)].map(((e,r)=>t*r==0?t+r?"e0"+(t+r):"1":"0"))))),options.over&&(options.baseType=Array);var tot=options.tot=0|(options.tot||(p||0)+(q||0)+(r||0)||options.basis&&options.basis.length),basis=options.basis&&(options.basis.length==2**tot||r<0||options.Cayley)&&options.basis||[...Array(2**tot)].map(((e,t)=>((1<<30)+t).toString(2).slice(-tot||-1).replace(/./g,((e,t)=>"0"==e?"":String.fromCharCode(66+t-(0!=r)))))).sort(((e,t)=>e.toString().length==t.toString().length?e>t?1:t>e?-1:0:e.toString().length-t.toString().length)).map((e=>e&&"e"+e.replace(/./g,(e=>("0"+(e.charCodeAt(0)-65)).slice(tot>9?-2:-1)))||"1")),low=1==basis.length?1:1*basis[1].match(/\d+/g)[0],grades=options.grades||options.dual&&basis.map(((e,t)=>t?1:0))||basis.map((e=>tot>9?(e.length-1)/2:e.length-1)),grade_start=grades.map(((e,t,r)=>r[t-1]!=e?t:-1)).filter((e=>e+1)).concat([basis.length]),simplify=(e,t,r,a)=>{var n,o,i=1,s=[],l=!0,c=e.match(tot>9?/(\d\d)/g:/(\d)/g);if(!c)return e;for(o=(e=c).length;l;){l=!1;for(var h=0;h<o;)e[h]===e[h+1]?(options.metric?i*=options.metric[e[h]-basis[1][1]]:e[h]-low>=t+a?i*=-1:e[h]-low<a&&(i=0),h+=2,l=!0):s.push(e[h++]);for(h=0;h<s.length-1;h++)if(s[h]>s[h+1]){n=s[h],s[h]=s[h+1],s[h+1]=n,i*=-1,l=!0;break}l&&(e=s,s=[],o=e.length)}var m=0==i?"0":(1==i?"":"-")+(s.length?"e"+s.join(""):"1");return brm&&brm[m]||brm&&brm["-"+m]&&"-"+brm["-"+m]||m},brm=(e=>{var t={};for(var a in basis)t["1"==basis[a]?"1":simplify(basis[a],p,q,r)]=basis[a];return t})(),simplify_bits=(e,t,a)=>{var n=a||p+q+r,o=0,i=e&t,s=e^t;if(i&(1<<r)-1)return[0,0];for(;n--;)o^=e>>=1;return o&=t,o^=i>>p+r,o^=o>>16,o^=o>>8,[1-2*(27030>>(15&(o^=o>>4))&1),s]},bc=e=>16843009*((e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135)>>24;if(!options.graded&&tot<=6||!1===options.graded||options.Cayley){var drm=basis.map(((e,t)=>({a:e,i:t}))).sort(((e,t)=>e.a.length>t.a.length?1:e.a.length<t.a.length?-1:+e.a.slice(1).split("").sort().join("")-+t.a.slice(1).split("").sort().join(""))).map((e=>e.i)).reverse(),drms=drm.map(((e,t)=>0==e||0==t?1:"-"==simplify(basis[e]+basis[t])[0]?-1:1)),metric=options.Cayley&&options.Cayley.map(((e,t)=>e[t]))||basis.map(((e,t)=>0|simplify(e+e,p,q,r)));metric[0]=1;var mulTable=options.Cayley||basis.map((e=>basis.map((t=>1==e?t:1==t?e:simplify(e+t,p,q,r)))));options.even&&(options.basis=basis.filter((e=>e.length%2==1))),options.basis&&!options.Cayley&&r>=0&&options.basis.length!=2**tot&&(metric=metric.filter(((e,t)=>-1!=options.basis.indexOf(basis[t]))),mulTable=mulTable.filter(((e,t)=>-1!=options.basis.indexOf(basis[t]))).map((e=>e.filter(((e,t)=>-1!=options.basis.indexOf(basis[t]))))),basis=options.basis);var gp=basis.map((e=>basis.map((e=>"0")))),cp=gp.map((e=>gp.map((e=>"0")))),cps=gp.map((e=>gp.map((e=>"0")))),op=gp.map((e=>gp.map((e=>"0")))),gpo={};basis.forEach(((e,t)=>basis.forEach(((e,r)=>{var a=mulTable[t][r].replace(/^-/,"");gpo[a]||(gpo[a]=[]),gpo[a].push([t,r])})))),basis.forEach(((e,t)=>{gpo[e].forEach((([e,r])=>op[t][e]=grades[t]==grades[e]+grades[r]?"0"==mulTable[e][r]?"0":("-"!=mulTable[e][r][0]?"":"-")+"b["+r+"]*this["+e+"]":"0")),gpo[e].forEach((([e,r])=>{gp[t][e]=("0"==gp[t][e]?"":gp[t][e]+"+")+("0"==mulTable[e][r]?"0":("-"!=mulTable[e][r][0]?"":"-")+"b["+r+"]*this["+e+"]"),cp[t][e]=("0"==cp[t][e]?"":cp[t][e]+"+")+(grades[t]==grades[r]-grades[e]?gp[t][e]:"0"),cps[t][e]=("0"==cps[t][e]?"":cps[t][e]+"+")+(grades[t]==Math.abs(grades[r]-grades[e])?gp[t][e]:"0")}))}));var generator=class extends(options.baseType||Float32Array){constructor(e){return super(e||basis.length),this}Grade(e,t){for(var r=0,a=(t=t||new this.constructor).length;r<a;r++)grades[r]==e?t[r]=this[r]:t[r]=0;return t}Even(e){for(var t=0,r=(e=e||new this.constructor).length;t<r;t++)grades[t]%2==0?e[t]=this[t]:e[t]=0;return e}nVector(e,...t){return this.set(t,grade_start[e]),this}Coeff(){for(var e=0,t=arguments.length;e<t;e+=2)this[arguments[e]]=arguments[e+1];return this}Map(e,...t){for(var r=0,a=e.length;r<a;r++)e[r]=~t.indexOf(grades[r])?-this[r]:this[r];return e}get Vector(){return this.slice(grade_start[1],grade_start[2])}toString(){for(var e=[],t=0;t<basis.length;t++)Math.abs(this[t])>1e-10&&e.push((1==this[t]&&t?"":-1==this[t]&&t?"-":1*this[t].toFixed(10))+(0==t?"":1==tot&&1==q?"i":basis[t].replace("e","e_")));return e.join("+").replace(/\+-/g,"-")||"0"}get Negative(){for(var e=new this.constructor,t=0;t<this.length;t++)e[t]=-this[t];return e}get Reverse(){for(var e=new this.constructor,t=0;t<this.length;t++)e[t]=this[t]*[1,1,-1,-1][grades[t]%4];return e}get Involute(){for(var e=new this.constructor,t=0;t<this.length;t++)e[t]=this[t]*[1,-1,1,-1][grades[t]%4];return e}get Conjugate(){for(var e=new this.constructor,t=0;t<this.length;t++)e[t]=this[t]*[1,-1,-1,1][grades[t]%4];return e}get Dual(){if(r)return this.map(((e,t,r)=>r[drm[t]]*drms[t]));var e=new this.constructor;return e[e.length-1]=1,this.Mul(e)}get UnDual(){if(r)return this.map(((e,t,r)=>r[drm[t]]*drms[r.length-t-1]));var e=new this.constructor;return e[e.length-1]=1,this.Div(e)}get Length(){return options.over?Math.sqrt(Math.abs(this.Mul(this.Conjugate).s.s)):Math.sqrt(Math.abs(this.Mul(this.Conjugate).s))}get VLength(){for(var e=0,t=0;t<this.length;t++)e+=this[t]*this[t];return Math.sqrt(e)}get Normalized(){if(3==p&&1==r){var e=this.Mul(this.Reverse),[t,a]=[e[0],e[15]];return 0==t?this:(e[0]=1/Math.sqrt(t),e[15]=-a/(2*Math.pow(Math.sqrt(t),3)),this.Mul(e))}var n=new this.constructor,o=this.Length;if(!o)return this;o=1/o;for(var i=0;i<this.length;i++)options.over?n[i]=this[i].Scale(o):n[i]=this[i]*o;return n}};generator.prototype.Add=new Function("b,res","res=res||new this.constructor();\n"+basis.map(((e,t)=>"res["+t+"]=b["+t+"]+this["+t+"]")).join(";\n").replace(/(b|this)\[(.*?)\]/g,((e,t,r)=>options.mix?"("+t+"."+(0|r?basis[r]:"s")+"||0)":e))+";\nreturn res"),generator.prototype.Scale=new Function("b,res","res=res||new this.constructor();\n"+basis.map(((e,t)=>"res["+t+"]=b*this["+t+"]")).join(";\n").replace(/(b|this)\[(.*?)\]/g,((e,t,r)=>options.mix?"("+t+"."+(0|r?basis[r]:"s")+"||0)":e))+";\nreturn res"),generator.prototype.Sub=new Function("b,res","res=res||new this.constructor();\n"+basis.map(((e,t)=>"res["+t+"]=this["+t+"]-b["+t+"]")).join(";\n").replace(/(b|this)\[(.*?)\]/g,((e,t,r)=>options.mix?"("+t+"."+(0|r?basis[r]:"s")+"||0)":e))+";\nreturn res"),generator.prototype.Mul=new Function("b,res","res=res||new this.constructor();\n"+gp.map(((e,t)=>"res["+t+"]="+e.join("+").replace(/\+\-/g,"-").replace(/(\w*?)\[(.*?)\]/g,((e,t,r)=>options.mix?"("+t+"."+(0|r?basis[r]:"s")+"||0)":e)).replace(/\+0/g,"")+";")).join("\n")+"\nreturn res;"),generator.prototype.LDot=new Function("b,res","res=res||new this.constructor();\n"+cp.map(((e,t)=>"res["+t+"]="+e.join("+").replace(/\+\-/g,"-").replace(/\+0/g,"").replace(/(\w*?)\[(.*?)\]/g,((e,t,r)=>options.mix?"("+t+"."+(0|r?basis[r]:"s")+"||0)":e))+";")).join("\n")+"\nreturn res;"),generator.prototype.Dot=new Function("b,res","res=res||new this.constructor();\n"+cps.map(((e,t)=>"res["+t+"]="+e.join("+").replace(/\+\-/g,"-").replace(/\+0/g,"").replace(/(\w*?)\[(.*?)\]/g,((e,t,r)=>options.mix?"("+t+"."+(0|r?basis[r]:"s")+"||0)":e))+";")).join("\n")+"\nreturn res;"),generator.prototype.Wedge=new Function("b,res","res=res||new this.constructor();\n"+op.map(((e,t)=>"res["+t+"]="+e.join("+").replace(/\+\-/g,"-").replace(/\+0/g,"").replace(/(\w*?)\[(.*?)\]/g,((e,t,r)=>options.mix?"("+t+"."+(0|r?basis[r]:"s")+"||0)":e))+";")).join("\n")+"\nreturn res;"),generator.prototype.Vee=new Function("b,res",("res=res||new this.constructor();\n"+op.map(((e,t)=>"res["+drm[t]+"]="+drms[t]+"*("+e.map((e=>e.replace(/\[(.*?)\]/g,(function(e,t){return"["+drm[0|t]+"]"+(drms[0|t]>0?"":"*-1")})))).join("+").replace(/\+\-/g,"-").replace(/\+0/g,"").replace(/(\w*?)\[(.*?)\]/g,((e,t,r)=>options.mix?"("+t+"."+(0|r?basis[r]:"s")+"||0)":e))+");")).join("\n")+"\nreturn res;").replace(/(b\[)|(this\[)/g,(e=>"b["==e?"this[":"b["))),generator.prototype.eigenValues=eigenValues,basis.forEach(((e,t)=>Object.defineProperty(generator.prototype,t?e:"s",{configurable:!0,get(){return this[t]},set(e){this[t]=e}})))}else{var basisg=grade_start.slice(0,grade_start.length-1).map(((e,t)=>basis.slice(e,grade_start[t+1]))),counts=grade_start.map(((e,t,r)=>t==r.length-1?0:r[t+1]-e)).slice(0,tot+1),basis_bits=basis.map((e=>"1"==e?0:e.slice(1).match(tot>9?/\d\d/g:/\d/g).reduce(((e,t)=>e+(1<<t-low)),0))),bits_basis=[];basis_bits.forEach(((e,t)=>bits_basis[e]=t));var metric=basisg.map(((e,t)=>e.map(((e,r)=>simplify_bits(basis_bits[grade_start[t]+r],basis_bits[grade_start[t]+r])[0])))),drms=basisg.map(((e,t)=>e.map(((e,r)=>simplify_bits(basis_bits[grade_start[t]+r],~basis_bits[grade_start[t]+r]&(1<<tot)-1)[0])))),generator=class extends Array{constructor(e){return super(e||tot),this}Grade(e,t){return(t=new this.constructor)[e]=this[e],t}nVector(e,...t){return this[e]=t,this}Coeff(){for(var e=0,t=arguments.length;e<t;e+=2)if(arguments[e+1]){var r=grades[arguments[e]];null==this[r]&&(this[r]=[]),this[r][arguments[e]-grade_start[r]]=arguments[e+1]}return this}Map(e,...t){}get Vector(){return this[1]}Add(e,t){t=t||new this.constructor;for(var r=0,a=Math.max(this.length,e.length);r<a;r++)if(!this[r]^!e[r])t[r]=this[r]?this[r].slice():e[r].slice();else if(this[r]||e[r]){null==t[r]&&(t[r]=[]);for(var n=0,o=Math.max(this[r].length,e[r].length);n<o;n++)"string"==typeof this[r][n]||"string"==typeof t[r][n]||"string"==typeof e[r][n]?this[r][n]?e[r][n]?t[r][n]="("+(this[r][n]||"0")+("-"==e[r][n][0]?"":"+")+(e[r][n]||"0")+")":t[r][n]=""+this[r][n]:t[r][n]=""+e[r][n]:t[r][n]=(this[r][n]||0)+(e[r][n]||0)}else;return t}Sub(e,t){t=t||new this.constructor;for(var r=0,a=Math.max(this.length,e.length);r<a;r++)if(this[r]&&e[r]){null==t[r]&&(t[r]=[]);for(var n=0,o=Math.max(this[r].length,e[r].length);n<o;n++)"string"==typeof this[r][n]||"string"==typeof t[r][n]||"string"==typeof e[r][n]?t[r][n]="("+(this[r][n]||"0")+"-"+(e[r][n]||"0")+")":t[r][n]=(this[r][n]||0)-(e[r][n]||0)}else t[r]=this[r]?this[r]:e[r]?e[r].map((e=>"string"==typeof e?"-"+e:-e)):void 0;return t}Scale(e){return this.map((t=>t&&t.map((t=>"string"==typeof t?t+"*"+e:t*e))))}Mul(e,t){t=t||new this.constructor;for(var r,a,n=!1,o=0;a=grade_start[o],r=this[o],o<this.length;o++)if(r)for(var i,s,l=0;s=grade_start[l],i=e[l],l<e.length;l++)if(i)for(var c=0;c<r.length;c++)if(r[c])for(var h=0;h<i.length;h++)if(i[h])if(o==l&&c==h)t[0]=t[0]||("string"==typeof r[0]||"string"==typeof i[h]?[""]:[0]),"string"==typeof r[c]||"string"==typeof t[0][0]||"string"==typeof i[h]?(t[0][0]=(t[0][0]?t[0][0]+("-"==r[c][0]?"":"+"):"")+r[c]+"*"+i[h]+(1!=metric[o][c]?"*"+metric[o][c]:""),n=!0):t[0][0]+=r[c]*i[h]*metric[o][c];else{var m=simplify_bits(basis_bits[a+c],basis_bits[s+h]),u=bc(m[1]),p=bits_basis[m[1]]-grade_start[u];t[u]||(t[u]=[]),"string"==typeof t[u][p]||"string"==typeof r[c]||"string"==typeof i[h]?(t[u][p]=(t[u][p]?t[u][p]+"+":"")+(1!=m[0]?-1==m[0]?"-":m[0]+"*":"")+r[c]+(1!=i[h]?"*"+i[h]:""),n=!0):t[u][p]=(t[u][p]||0)+m[0]*r[c]*i[h]}return n?t.map((e=>e.map((e=>e&&!(e+"").match(/-{0,1}\w+/)?"("+e+")":e)))):t}Wedge(e,t){t=t||new this.constructor;for(var r,a,n=0;a=grade_start[n],r=this[n],n<this.length;n++)if(r)for(var o,i,s=0;i=grade_start[s],o=e[s],s<e.length;s++)if(o)for(var l=0;l<r.length;l++)if(r[l])for(var c=0;c<o.length;c++)if(o[c]&&(n!=s||l!=c)){var h=basis_bits[a+l],m=basis_bits[i+c],u=simplify_bits(h,m,tot),p=bc(u[1]),f=bits_basis[u[1]]-grade_start[p];p==n+s&&(t[p]||(t[p]=[]),t[p][f]=(t[p][f]||0)+u[0]*r[l]*o[c])}return t}OPNS_GLSL(e,t){for(var r,a,n="",o=0,i=0;a=grade_start[i],r=this[i],i<this.length;i++)if(r)for(var s,l,c=0;l=grade_start[c],s=e[c],c<e.length;c++)if(s)for(var h=0;h<counts[i];h++)for(var m=0;m<counts[c];m++)if(i!=c||h!=m){var u=basis_bits[a+h],p=basis_bits[l+m],f=simplify_bits(u,p,tot),d=bc(f[1]),g=bits_basis[f[1]]-grade_start[d];d==i+c&&(d,n+=`res[${g}]${"1"==f[0]?"+=":"-="}(${(t[h]+"").replace(/1([^.\d])|1$/g,"1.0$1")})*b[${m}]; //${o++}\n`)}n=n.split("\n").filter((e=>e)).sort(((e,t)=>(0|e.match(/\d+/)[0])-(0|t.match(/\d+/)[0])||(0|e.match(/\d+$/)[0])-(0|t.match(/\d+$/)[0]))).map((e=>e.replace(/\/\/\d+$/,"")));var v="float sum=0.0; float res=0.0;\n";d=0;return n.forEach((e=>{var t=0|e.match(/\d+/)[0];t!=d&&(v+="sum += res*res;\nres = 0.0;\n"),v+=e.replace(/\[\d+\]/,"")+"\n",d=t})),v+="sum += res*res;\n"}IPNS_GLSL(e,t){for(var r,a,n="",o=0,i=0;a=grade_start[i],r=this[i],i<this.length;i++)if(r)for(var s,l,c=0;l=grade_start[c],s=e[c],c<e.length;c++)if(s)for(var h=0;h<counts[i];h++)for(var m=0;m<counts[c];m++){var u=basis_bits[a+h],p=basis_bits[l+m],f=simplify_bits(u,p,tot),d=bc(f[1]),g=bits_basis[f[1]]-grade_start[d];d==Math.abs(i-c)&&t[h]&&(d,n+=`res[${g}]${"1"==f[0]?"+=":"-="}(${(t[h]+"").replace(/1([^.\d])|1$/g,"1.0$1")})*b[${m}]; //${o++}\n`)}n=n.split("\n").filter((e=>e)).sort(((e,t)=>(0|e.match(/\d+/)[0])-(0|t.match(/\d+/)[0])||(0|e.match(/\d+$/)[0])-(0|t.match(/\d+$/)[0]))).map((e=>e.replace(/\/\/\d+$/,"")));var v="float sum=0.0; float res=0.0;\n";d=0;return n.forEach((e=>{var t=0|e.match(/\d+/)[0];t!=d&&(v+="sum += res*res;\nres = 0.0;\n"),v+=e.replace(/\[\d+\]/,"")+"\n",d=t})),v+="sum += res*res;\n"}LDot(e,t){t=t||new this.constructor;for(var r,a,n=0;a=grade_start[n],r=this[n],n<this.length;n++)if(r)for(var o,i,s=0;i=grade_start[s],o=e[s],s<e.length;s++)if(o)for(var l=0;l<r.length;l++)if(r[l])for(var c=0;c<o.length;c++)if(o[c])if(n==s&&l==c)t[0]=t[0]||[0],t[0][0]+=r[l]*o[c]*metric[n][l];else{var h=simplify_bits(basis_bits[a+l],basis_bits[i+c]),m=bc(h[1]),u=bits_basis[h[1]]-grade_start[m];m==s-n&&(t[m]||(t[m]=[]),t[m][u]=(t[m][u]||0)+h[0]*r[l]*o[c])}return t}Dot(e,t){t=t||new this.constructor;for(var r,a,n=0;a=grade_start[n],r=this[n],n<this.length;n++)if(r)for(var o,i,s=0;i=grade_start[s],o=e[s],s<e.length;s++)if(o)for(var l=0;l<r.length;l++)if(r[l])for(var c=0;c<o.length;c++)if(o[c])if(n==s&&l==c)t[0]=t[0]||[0],t[0][0]+=r[l]*o[c]*metric[n][l];else{var h=simplify_bits(basis_bits[a+l],basis_bits[i+c]),m=bc(h[1]),u=bits_basis[h[1]]-grade_start[m];m==Math.abs(s-n)&&(t[m]||(t[m]=[]),t[m][u]=(t[m][u]||0)+h[0]*r[l]*o[c])}return t}Vee(e,t){return this.Dual.Wedge(e.Dual).Dual}toString(){return[...this].map(((e,t)=>e&&e.map(((e,r)=>e?((e+"").match(/[\+\-\*]/)?"("+e+")":e)+(0==t?"":basisg[t][r]):void 0)).filter((e=>e)).join("+"))).filter((e=>e)).join("+").replace(/\+\-/g,"-")||"0"}get s(){return this[0]&&this[0][0]||0}get Length(){var e=0;return this.forEach(((t,r)=>t&&t.forEach(((t,a)=>e+=(t||0)**2*metric[r][a])))),Math.abs(e)**.5}get VLength(){var e=0;return this.forEach(((t,r)=>t&&t.forEach(((t,r)=>e+=(t||0)**2)))),Math.abs(e)**.5}get Reverse(){var e=new this.constructor;return this.forEach(((t,r)=>t&&t.forEach(((t,a)=>{e[r]||(e[r]=[]),e[r][a]=this[r][a]*[1,1,-1,-1][r%4]})))),e}get Involute(){var e=new this.constructor;return this.forEach(((t,r)=>t&&t.forEach(((t,a)=>{e[r]||(e[r]=[]),e[r][a]=this[r][a]*[1,-1,1,-1][r%4]})))),e}get Conjugate(){var e=new this.constructor;return this.forEach(((t,r)=>t&&t.forEach(((t,a)=>{e[r]||(e[r]=[]),e[r][a]=this[r][a]*[1,-1,-1,1][r%4]})))),e}get Dual(){var e=new this.constructor;return this.forEach(((t,r)=>{t&&(e[tot-r]=[],t.forEach(((t,a)=>e[tot-r][counts[r]-1-a]=drms[r][a]*t)))})),e}get Normalized(){return this.Scale(1/this.Length)}}}var res=class Element extends generator{constructor(e){return super(e),this.upgrade&&this.upgrade(),this}Grade(e,t){return t=t||new Element,super.Grade(e,t)}Div(e,t){return this.Mul(e.Inverse,t)}LDiv(e,t){return e.Inverse.Mul(this,t)}Split(e=50){var t=Math.floor((p+q+r)/2),a=this.map((e=>e)),n=this.map((e=>e)),o=1,i=[...Array(t)].map(((e,t)=>{o*=t+1;var r=n.Scale(1/o);return n=n.Wedge(a),r}));if(t<3){var s=this.Dot(this).s,l=this.Wedge(this);if(l.VLength<1e-5)return[this];var c=.5*Math.sqrt(s**2-l.Mul(l).s),h=[.5*s+c,.5*s-c].sort(((e,t)=>Math.abs(e)<Math.abs(t)?-1:1))}else{var m=i.map(((e,r)=>e.Mul(e).s*(-1)**(t-r+t%2)));h=eigenValues([...Array(t)].map(((e,r)=>[...Array(t)].map(((e,a)=>a==t-1?m[t-r-1]:r-1==a?1:0)))),e).sort(((e,t)=>Math.abs(e)<Math.abs(t)?-1:1))}i=[Element.Scalar(1),...i,Element.Scalar(0)];var u=Element.Scalar(0),f=h.slice(1).map((e=>{for(var r=Math.floor(t/2),a=Element.Scalar(0),n=Element.Scalar(0),o=0;o<=r;++o)a.Add(i[2*o+1].Scale(e**(r-o)),a),n.Add(i[2*o].Scale(e**(r-o)),n);if(0==n.VLength)return Element.Scalar(0);var s=a.Div(n);return u.Add(s,u),s}));return[this.Sub(u),...f]}Factorize(e=50){var t=this.Grade(2).Split(e),r=this.Scale(1),a=t.slice(0,t.length-1).map(((e,t)=>{var a=Element.Scalar(r.s).Add(e),n=Math.sqrt(a.Reverse.Mul(a).s);return a.Scale(1/n)}));return a.push(a.reduce(((e,t)=>e.Mul(t.Reverse)),Element.Scalar(1)).Mul(r)),a}Exp(e=!1){if(1==r&&tot<=4&&Math.abs(this[0])<1e-9&&!options.over&&!e){var t=this[8]*this[8]+this[9]*this[9]+this[10]*this[10];if(0==t)return new Element([1,0,0,0,0,this[5],this[6],this[7],0,0,0,0,0,0,0,0]);var a=this[5]*this[10]+this[6]*this[9]+this[7]*this[8],n=Math.sqrt(t),o=Math.cos(n),i=Math.sin(n)/n,s=a/t*(o-i),l=(Element.Element(o,0,0,0,0,i*this[5]+s*this[10],i*this[6]+s*this[9],i*this[7]+s*this[8],i*this[8],i*this[9],i*this[10],0,0,0,0,a*i),Math.sqrt(Math.abs(this.Dot(this).s)));if(Math.abs(l)<1e-5)return this.Add(Element.Scalar(1));var c=this.Wedge(this).Scale(-1/(2*l));return Element.Add(Element.Sub(Math.cos(l),c.Scale(Math.sin(l))),Element.Div(Element.Mul(Element.Add(Math.sin(l),c.Scale(Math.cos(l))),this),Element.Add(l,c)))}if(!e&&Math.abs(this[0])<1e-9&&!options.over)return this.Grade(2).Split().reduce(((e,t)=>{var r=t.Mul(t).s,a=Math.sqrt(Math.abs(r));return a<=1e-5?e.Mul(Element.Scalar(1).Add(t)):r<0?e.Mul(Element.Scalar(Math.cos(a)).Add(t.Scale(Math.sin(a)/a))):e.Mul(Element.Scalar(Math.cosh(a)).Add(t.Scale(Math.sinh(a)/a)))}),Element.Scalar(1));if(options.dual){var h=Math.exp(this.s);return this.map(((e,t)=>t?e*h:h))}for(var m=Element.Scalar(1),u=1,p=this.Scale(1),f=this.Scale(1),d=1;d<15;d++)m=m.Add(p.Scale(1/u)),p=p.Mul(f),u*=d+1;return m}Log(e=!1){if(!options.over){if(!e){if(4==tot&&0==q&&1==r&&!options.over){if(Math.abs(this.s)>=.99999)return Element.Bivector(this[5],this[6],this[7],0,0,0).Scale(Math.sign(this.s));var t=1/(1-this[0]*this[0]),a=Math.acos(this[0])*Math.sqrt(t),n=t*this[15]*(1-this[0]*a);return Element.Bivector(n*this[10]+a*this[5],-n*this[9]+a*this[6],n*this[8]+a*this[7],a*this[8],a*this[9],a*this[10])}return this.Factorize().reduce(((e,t)=>{var[r,a]=[t.s,t.Grade(2)],n=a.Mul(a).s,o=Math.sqrt(Math.abs(n));return Math.abs(n)<1e-5?e.Add(a):n<0?e.Add(a.Scale(Math.acos(r)/o)):e.Add(a.Scale(Math.acosh(r)/o))}),Element.Scalar(0))}a=this.Grade(2);var o=Element.Dot(a,a).s;if(Math.abs(o)<=1e-5)return this.s<0?a.Scale(-1):a;var i=Math.sqrt(-o),s=Element.Wedge(a,a);if(Math.abs(s[s.length-1])<=1e-5||Math.abs(this.s)<=1e-5)return a.Scale(Math.atan2(i,this.s)/i);var l=s.Scale(-1/(2*i));return Element.Mul(Element.Mul(Element.Add(Math.atan2(i,this.s),l.Scale(1/this.s)),a),Element.Sub(i,l)).Scale(1/(i*i))}}Map(){var e=new Element;return super.Map(e,...arguments)}static Element(){return new Element([...arguments])}static Coeff(){return(new Element).Coeff(...arguments)}static Scalar(e){return(new Element).Coeff(0,e)}static Vector(){return(new Element).nVector(1,...arguments)}static Bivector(){return(new Element).nVector(2,...arguments)}static Trivector(){return(new Element).nVector(3,...arguments)}static nVector(e){return(new Element).nVector(...arguments)}static toEl(e){return e instanceof Function&&(e=e()),e instanceof Element||(e=Element.Scalar(e)),e}static Add(e,t,r){for(;e.call;)e=e();for(;t.call;)t=t();return e.Add&&t.Add?e.Add(t,r):"string"==typeof e||"string"==typeof t?e.toString()+t.toString():(e instanceof Array&&!e.Add)^(t instanceof Array&&!t.Add)?e instanceof Array?e.map((e=>Element.Add(e,t))):t.map((t=>Element.Add(e,t))):e instanceof Array&&t instanceof Array&&e.length==t.length?e.map(((e,r)=>Element.Add(e,t[r]))):e instanceof Element||t instanceof Element?(e=Element.toEl(e),t=Element.toEl(t),e.Add(t,r)):e+t}static Sub(e,t,r){for(;e.call;)e=e();for(;t&&t.call;)t=t();return e.Sub&&t&&t.Sub?e.Sub(t,r):t&&e instanceof Array^t instanceof Array?e instanceof Array?e.map((e=>Element.Sub(e,t))):t.map((t=>Element.Sub(e,t))):t&&e instanceof Array&&t instanceof Array&&e.length==t.length?e.map(((e,r)=>Element.Sub(e,t[r]))):1==arguments.length?Element.Mul(e,-1):e instanceof Element||t instanceof Element?(e=Element.toEl(e),t=Element.toEl(t),e.Sub(t,r)):e-t}static Mul(e,t,r){for(;e.call&&!e.length;)e=e();for(;t.call&&!t.length;)t=t();if(e.Mul&&t.Mul)return e.Mul(t,r);if(e.call&&t.call)return(r,a)=>Element.Mul(e(r),t(a));if(Number.isFinite(e)&&t.Scale)return t.Scale(e);if(Number.isFinite(t)&&e.Scale)return e.Scale(t);if(e instanceof Array&&t instanceof Array){if(!(e[0]instanceof Array&&!(e[0]instanceof Element)||t[0]instanceof Array&&!(t[0]instanceof Element))){var a=tot?Element.Scalar(0):0;return e.forEach(((e,r)=>a=Element.Add(a,Element.Mul(e,t[r]),a))),a}return t[0]instanceof Array?1==(a=e.map(((e,r)=>t[0].map(((r,a)=>{var n=tot?Element.Scalar(0):0;return e.forEach(((e,r)=>n=Element.Add(n,Element.Mul(e,t[r][a])))),n}))))).length&&1==a[0].length?a[0][0]:a:e.map(((r,a)=>Element.Mul(e[a],t)))}if(e instanceof Array^t instanceof Array)return e instanceof Array?e.map((e=>Element.Mul(e,t))):t.map((t=>Element.Mul(e,t)));a=e*t;return isNaN(a)?(e=Element.toEl(e),t=Element.toEl(t),e.Mul(t,r)):a}static LDot(e,t,r){for(;e.call;)e=e();for(;t.call;)t=t();return t instanceof Array&&!(e instanceof Array)?t.map((t=>Element.LDot(e,t))):e instanceof Array&&!(t instanceof Array)?e.map((e=>Element.LDot(e,t))):e instanceof Element||t instanceof Element?(e=Element.toEl(e),t=Element.toEl(t),e.LDot(t,r)):e*t}static Dot(e,t,r){for(;e.call;)e=e();for(;t.call;)t=t();return e instanceof Element||t instanceof Element?(e=Element.toEl(e),t=Element.toEl(t),e.Dot(t,r)):e|t}static Wedge(e,t,r){if(typeof e in{boolean:1,number:1}&&typeof t in{boolean:1,number:1})return e^t;for(;e.call;)e=e();for(;t.call;)t=t();return e.Wedge?e.Wedge(Element.toEl(t),r):e instanceof Array&&t instanceof Array?e.map((e=>t.map((t=>Element.Mul(e,t))))):e instanceof Element||t instanceof Element?(e=Element.toEl(e),t=Element.toEl(t),e.Wedge(t,r)):e*t}static Vee(e,t,r){if(typeof e in{boolean:1,number:1}&&typeof t in{boolean:1,number:1})return e&t;for(;e.call;)e=e();for(;t.call;)t=t();return e.Vee?e.Vee(Element.toEl(t),r):e instanceof Element||t instanceof Element?(e=Element.toEl(e),t=Element.toEl(t),e.Vee(t,r)):0}static sw(e,t){if("string"==typeof t||"number"==typeof t)return t;for(;e.call;)e=e();for(;t.call;)t=t();return e.sw?e.sw(t):t instanceof Array&&!t.Add?t.map((t=>Element.sw(e,t))):(e=Element.toEl(e),t=Element.toEl(t),e.Mul(t).Mul(e.Reverse))}static Div(e,t,r){for(;e.call;)e=e();for(;t.call;)t=t();if(e instanceof Array&&t instanceof Array&&t[0]instanceof Array){var a,n,o,i,s,l,c=t.flat(),h=t[0].length,m=new Array(h),u=new Array(h);for(a=0;a<h;a++){for(s=a*h,n=0;n<a;n++){for(l=n*h,m[n]=c[s+n],o=0;o<n;o++)m[n]-=m[o]*c[l+o];if(0==c[l+n])return null;c[s+n]=m[n]/c[l+n]}for(i=c[s+a],o=0;o<a;o++)i-=m[o]*c[s+o];c[s+a]=i}for(a=0;a<h;a++)for(u[a]=e[a],n=0;n<=a-1;n++)u[a]-=c[a*h+n]*u[n];for(a=h-1;a>=0;a--)for(u[a]/=c[a*h+a],n=a+1;n<h;n++)u[a]-=c[n*h+a]*u[n];return u}return e instanceof Element||t instanceof Element?(e=Element.toEl(e),Number.isFinite(t)?e.Scale(1/t,r):(t=Element.toEl(t),e.Div(t,r))):e/t}static Pow(e,t,r){for(;e.call;)e=e();for(;t.call;)t=t();return e.Pow?e.Pow(t,r):e===Math.E&&t.Exp?t.Exp():2===t?this.Mul(e,e,r):e instanceof Element||t instanceof Element?-1===t?e.Inverse:(e=Element.toEl(e)).Pow(t):e**t}static exp(e){for(;e.call;)e=e();return e.Exp?e.Exp():Math.exp(e)}static Dual(e){return"boolean"==typeof e||"number"==typeof e?!e:Element.toEl(e).Dual}static Involute(e){return Element.toEl(e).Involute}static Reverse(e){return Element.toEl(e).Reverse}static Conjugate(e){return e.Conjugate?e.Conjugate:e instanceof Array?e[0].map(((t,r)=>e.map(((t,a)=>Element.Conjugate(e[a][r]))))):Element.toEl(e).Conjugate}static Normalize(e){return Element.toEl(e).Normalized}static Length(e){return Element.toEl(e).Length}static eq(e,t){if(!(e instanceof Element&&t instanceof Element))return e==t;for(;e.call;)e=e();for(;t.call;)t=t();for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0}static neq(e,t){if(!(e instanceof Element&&t instanceof Element))return e!=t;for(;e.call;)e=e();for(;t.call;)t=t();for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!0;return!1}static lt(e,t){for(;e.call;)e=e();for(;t.call;)t=t();return(e instanceof Element?e.Length:e)<(t instanceof Element?t.Length:t)}static gt(e,t){for(;e.call;)e=e();for(;t.call;)t=t();return(e instanceof Element?e.Length:e)>(t instanceof Element?t.Length:t)}static lte(e,t){for(;e.call;)e=e();for(;t.call;)t=t();return(e instanceof Element?e.Length:e)<=(t instanceof Element?t.Length:t)}static gte(e,t){for(;e.call;)e=e();for(;t.call;)t=t();return(e instanceof Element?e.Length:e)>=(t instanceof Element?t.Length:t)}static describe(e){return!0===e&&console.log(`Basis\n${basis}\nMetric\n${metric.slice(1,1+tot)}\nCayley\n${mulTable.map((e=>e.map((e=>("           "+e).slice(-2-tot))))).join("\n")}\nMatrix Form:\n`+gp.map((e=>e.map((e=>e.match(/(-*b\[\d+\])/))).map((e=>e&&(e[1].match(/-/)||" ")+String.fromCharCode(65+1*e[1].match(/\d+/))||" 0")))).join("\n")),{basis:basisg||basis,metric:metric,mulTable:mulTable,matrix:gp.map((e=>e.map((e=>e.replace(/\*this\[.+\]/,"").replace(/b\[(\d+)\]/,((e,t)=>(-1==metric[t]||0==metric[t]&&grades[t]>1&&(-1)**grades[t]==(metric[basis.indexOf(basis[t].replace("0",""))]||(-1)**grades[t])?"-":"")+basis[t])).replace("--","")))))}}static sum(e){var t=Element,r=t.describe().mulTable,a=e.describe().mulTable,n=t.describe().basis,o=e.describe().basis,i=n.filter((e=>e.match(/e/))).map((e=>e.match(/\d/g))).flat().map((e=>0|e)).sort(((e,t)=>t-e))[0],s=o.filter((e=>e.match(/e/))).map((e=>e.match(/\d/g))).flat().map((e=>0|e)).sort(((e,t)=>t-e))[0];o.filter((e=>e.match(/e/))).map((e=>e.match(/\d/g))).flat().map((e=>0|e)).sort(((e,t)=>e-t))[0];a=a.map((e=>e.map((e=>e.match(/e/)?e.replace(/(\d)/g,(e=>(0|e)+i)):e.replace("1","e"+(1+s+i)))))),o=o.map(((e,t)=>0==t?e.replace("1","e"+(1+s+i)):e.replace(/(\d)/g,(e=>(0|e)+i))));var l=[...n,...o],c=r.map(((e,t)=>[...e,...a[0].map((e=>"0"))])).concat(a.map(((e,t)=>[...r[0].map((e=>"0")),...e]))),h=[...n.map((e=>"1"==e?0:e.length-1)),...o.map(((e,t)=>t?e.length-1:0))],m=Algebra({basis:l,Cayley:c,grades:h,tot:Math.log2(n.length)+Math.log2(o.length)});return m.Scalar=function(e){for(var t=new m,r=0;r<t.length;r++)t[r]=l[r]==c[r][r]?e:0;return t},m}static graph(e,t){if(!e)return;var r=e;if((t=t||{}).scale=t.scale||1,t.camera=t.camera||(4!=tot?Element.Scalar(1):Element.Bivector(0,0,0,0,0,t.p||0).Exp().Mul(Element.Bivector(0,0,0,0,t.h||0,0).Exp())),t.conformal&&4==tot)var a=t.ni||this.Coeff(4,1,3,1),n=t.no||this.Coeff(4,.5,3,-.5),o=n.Scale(-1);var i=t.width,s=t.height,l=t.canvas,c=new Element([0,0,0,0,0,0,0,0,0,0,0,-5,0,0,1,0]),h=this.Coeff(4,1),m=(new Element,e=>{if(!e)return e;for(;e.call;)e=e();if(e instanceof Element&&16==e.length&&e[8]**2+e[9]**2+e[10]**2>1e-4)return e=[[t.clip||2,1,0,0],[-(t.clip||2),1,0,0],[t.clip||2,0,1,0],[-(t.clip||2),0,1,0],[t.clip||2,0,0,1],[-(t.clip||2),0,0,1]].map((t=>{var r=Element.Vector(...t).Wedge(e);return r[14]?r.Scale(1/r[14],r):void 0})).filter((e=>e&&Math.abs(e[13])<=(t.clip||2)+.001&&Math.abs(e[12])<=(t.clip||2)+.001&&Math.abs(e[11])<=(t.clip||2)+.001)),e.map((e=>c.Vee(t.camera.Mul(e).Mul(t.camera.Conjugate)).Wedge(h)));if(e instanceof Element&&16==e.length&&e.Grade(1).Length>.01){var r=Element.Add(1,Element.Mul(e.Normalized,Element.Coeff(3,1))).Normalized;return(e=Element.sw(r,[[-1,-1],[-1,1],[1,1],[-1,-1],[1,1],[1,-1]].map((([t,r])=>Element.Trivector(t*e.Length,0,r*e.Length,1))))).map((e=>c.Vee(t.camera.Mul(e).Mul(t.camera.Conjugate)).Wedge(h)))}return 4==tot&&e instanceof Element&&16==e.length?c.Vee(t.camera.Mul(e).Mul(t.camera.Conjugate)).Wedge(h):e.length==2**tot?Element.sw(t.camera,e):e});if(t.gl&&(4!=tot||!t.conformal))return Element.graphGL(e,t);if(t.up)return Element.graphGL2(e,t);if(!(e instanceof Function)||0===e.length){var u,p,f,d,g=!1,v=5==tot?[0,8,11,13,19,17,22,26]:3==tot?[0,1,2,3,4,5,6,7]:[0,7,9,10,13,12,14,15];function T(e,l){l&&e&&e instanceof Function&&(e=e()),u=-2,p=t.conformal?-1.85:1.85,f=0,d="#444";var c=(new DOMParser).parseFromString(`<SVG viewBox="-2 -${2*(s/i||1)} 4 ${4*(s/i||1)}" style="width:${i||512}px; height:${s||512}px; background-color:#eee; -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none">\n            ${t.grid?(()=>{if(4==tot&&!t.conformal){const s=(e,r,a,n,o=0,i=0,s=0,l=1)=>[`<G stroke-opacity="${l}" fill-opacity="${l}">`,...[...Array(e+1)].map(((l,c)=>{var h=r.map(((e,r)=>e*(3==r?1:t.gridSize||1))),u=a.map(((e,r)=>e*(3==r?1:t.gridSize||1)));h[n]=u[n]=(c-e/2)/(e/2)*(t.gridSize||1);var p=Element.Trivector(...h),f=m(p),d=Element.Trivector(...u),g=m(d),v=t.scale*f[drm[2]]/f[drm[1]];6!=drm[1]&&14!=drm[1]||(v*=-1);var b=-t.scale*f[drm[3]]/f[drm[1]],E=t.scale*g[drm[2]]/g[drm[1]];6!=drm[1]&&14!=drm[1]||(E*=-1);var y=-t.scale*g[drm[3]]/g[drm[1]],M=`<line x1="${v}" y1="${b}" x2="${E}" y2="${y}" stroke="black" stroke-width="${c%10==0?.005:c%5==0?.002:5e-4}" />`;return o&&c&&c!=e&&(M+=`<text text-anchor="middle" font-size="0.04" fill="black" x="${1==o?v+i:E+i}" y="${s+(1==o?b:y)}" >${((r[n]<0?-1:1)*(c-e/2)/(e/2)*(t.gridSize||1)).toFixed(1)}</text>`),M})),"</G>"];var e=Element.sw(t.camera,Element.Trivector(1,0,0,0)).Dual.Dot(Element.Vector(0,0,0,1)).s,r=e>0?1:-1,a=Element.sw(t.camera,Element.Trivector(0,0,1,0)).Dual.Dot(Element.Vector(0,0,0,1)).s,n=a>0?1:-1,o=Math.max(0,Math.min(1,5*Math.abs(a))),i=Math.max(0,Math.min(1,5*Math.abs(e)));return[...s(20,[-1,-1,-1,1],[1,-1,1,1],2,t.labels?r:0,0,.05),...s(20,[-1,-1,-1,1],[1,-1,1,1],0,t.labels?n:0,0,.05),...s(20,[-1,-1,n,1],[1,1,n,1],0,0,0,0,o),...s(20,[-1,1,n,1],[1,-1,n,1],1,t.labels?-1!=r?1:2:0,n*r*-.05,0,o),...s(20,[r,1,-1,1],[r,-1,1,1],1,t.labels?-1!=n?1:2:0,n*r*.05,0,i),...s(20,[r,-1,-1,1],[r,1,1,1],2,0,0,0,i)].join("")}const s=t.scale,l=10/s|0,c=t.camera.e02,h=t.camera.e01,u=Math.min(1,10*(s-.2));if(t.scale<.1)return;const p=(e,t,r,a,n)=>[...Array(2*e+1)].map(((o,i)=>`<line x1="${t?-10:((i-e)*r-(tot<4?2*h:0))*s}" y1="${t?((i-e)*r-(tot<4?2*c:0))*s:-10}" x2="${t?10:((i-e)*r-(tot<4?2*h:0))*s}" y2="${t?((i-e)*r-(tot<4?2*c:0))*s:10}" stroke-width="${a}" stroke="${n}"/>`));return[`<G stroke-opacity='${u}' fill-opacity='${u}'>`,...p(2*l,0,.2,.005,"#DDD"),...p(2*l,1,.2,.005,"#DDD"),...p(l,0,1,.005,"#AAA"),...p(l,1,1,.005,"#AAA"),...p(l,0,5,.005,"#444"),...p(l,1,5,.005,"#444")].concat(t.labels?[...Array(4*l+1)].map(((e,t)=>t-2*l==0?"":`<text text-anchor="middle" font-size="0.05" x="${(.2*(t-2*l)-(tot<4?2*h:0))*s}" y="0.06" >${(.2*(t-2*l)).toFixed(1)}</text>`)):[]).concat(t.labels?[...Array(4*l+1)].map(((e,t)=>`<text text-anchor="end" font-size="0.05" y="${(.2*(t-2*l)-(tot<4?2*c:0))*s-.01}" x="-0.01" >${(-.2*(t-2*l)).toFixed(1)}</text>`)):[]).join("")+"</G>"})():""}\n            // Handle conformal 2D elements.\n            ${t.conformal?e.map&&e.map(((e,i)=>{if(!(e==Element.graph&&!1!==l||0==i&&t.animate&&!1!==l)||(g=!0,requestAnimationFrame((()=>{var e=T(r,!D||document.body.contains(D)).innerHTML;D&&(D.innerHTML=e)})),t.animate)){for(;e.call;)e=e();t.ipns&&e instanceof Element&&(e=e.Dual);var s=t.scale,c=t.lineWidth||1,h=t.pointRadius||1,m=(e,t,r)=>{if(e>=0)return"none";var a=t*Math.PI,n=a/Math.max(Math.round(a/r),1);return`${n} ${n}`};if(e instanceof Array)return u=p=f=0,(e=e.map((e=>{for(;e.call;)e=e();return e.Scale(-1/e.Dot(a).s)}))).forEach((e=>{u+=s*e.e1,p+=s*-e.e2})),u/=e.length,p/=e.length,e.length>2?`<POLYGON STYLE="pointer-events:none; fill:${d};opacity:0.7" points="${e.map((e=>s*e.e1+","+-e.e2*s+" "))}"/>`:`<LINE style="pointer-events:none" x1=${e[0].e1*s} y1=${-e[0].e2*s} x2=${e[1].e1*s} y2=${-e[1].e2*s} stroke="${d||"#888"}"/>`;if("string"==typeof e&&"<"==e[0])return e;if("string"==typeof e){var v="_"==e[0]?"":`<text x="${u}" y="${p}" font-family="Verdana" font-size="${.1*t.fontSize||.1}" style="pointer-events:none" fill="${d||"#333"}" transform="rotate(${f},${u},${p})">&nbsp;${e}&nbsp;</text>`;return p+=.14,v}if("number"==typeof e)return d="#"+(e+(1<<25)).toString(16).slice(-6),"";var b=e.Dot(n.Scale(-1)),E=a.Scale(-1).Dot(e);if(1e-6*b.VLength>E.VLength)return"";var y=E.Dot(n.Scale(-1)),M=a.Wedge(E).Dot(n.Scale(-1));if(1e-6*y.VLength>M.VLength)var A=!0,_=y;else A=!1,_=M;var x=_.Length;e=e.Scale(1/x);var S=(_=_.Scale(1/x)).Grade(0).VLength>.001,L=_.Grade(1).VLength>.001,w=_.Grade(2).VLength>.001;if(A||!S||L||w){if(A&&!S&&L&&!w){var C=o.LDot(e).Div(e);a.Dot(e);return u=s*-C.e1,p=s*C.e2,f=Math.atan2(-e[14],e[13])/Math.PI*180,`<LINE style="pointer-events:none" x1=${u-10} y1=${p} x2=${u+10} y2=${p} stroke="${d||"#888"}" transform="rotate(${f},${u},${p})"/>`}if(A||S||L||!w){if(A||S||!L||w)return"";f=0;var R=a,P=n,$=e.Wedge(R),N=e.LDot(e).s/$.LDot($).s,F=(B=Math.sqrt(Math.abs(N)),R.Wedge(P).LDot($).Normalized.Mul(Element.Scalar(B))),I=e.Div($);if(I=I.Div(I.LDot(Element.Sub(R))),0==$&&(I=e.Dot(Element.Coeff(4,-1)),N=-1),u=s*I.e1,p=s*-I.e2,0==N)return`<CIRCLE onmousedown="this.parentElement.sel=${i}" cx="${u}" cy="${p}" r="${.03*h}" stroke-width="${.01*c}" fill="none" stroke="${d||"green"}"/>`;if(N>0)var z=d||"green",O="none";else z="none",O=d||"green";u=s*(I.e1+F.e1),p=s*(-I.e2-F.e2);v=`<CIRCLE onmousedown="this.parentElement.sel=${i}" cx="${u}" cy="${p}" r="${.03*h}" fill="${z}" stroke-width="${.01*c}" stroke="${O}" stroke-dasharray="${m(N,.03*h,.02*c)}" />`;return u=s*(I.e1-F.e1),p=s*(-I.e2+F.e2),v+`<CIRCLE onmousedown="this.parentElement.sel=${i}" cx="${u}" cy="${p}" r="${.03*h}" fill="${z}" stroke-width="${.01*c}" stroke="${O}" stroke-dasharray="${m(N,.03*h,.02*c)}" />`}C=e.Div(a.LDot(e));u=s*-C.e1,p=s*C.e2;var j=e.Mul(e.Conjugate).s,B=Math.sqrt(Math.abs(j))*s;return`<CIRCLE onmousedown="this.parentElement.sel=${i}" cx="${u}" cy="${p}" r="${B}" fill="none" stroke="${d||"green"}" stroke-dasharray="${m(j,B,.02*c)}"/>`}return _.s<0&&(e=Element.Sub(e)),u=s*e.e1,p=s*-e.e2,f=0,`<CIRCLE onmousedown="this.parentElement.sel=${i}" cx="${u}" cy="${p}" r="${.03*h}" fill="${d||"green"}"/>`}})):e.map&&e.map(((e,a)=>{if(!(e==Element.graph&&!1!==l||0==a&&t.animate&&!1!==l)||(g=!0,requestAnimationFrame((()=>{var e=T(r,!D||document.body.contains(D)).innerHTML;D&&(D.innerHTML=e)})),t.animate)){for(;e instanceof Function;)e=e();if(void 0!==(e=e instanceof Array?e.map(m):m(e))){if(t.dual&&e instanceof Element&&(e=e.Dual),e instanceof Array&&e.length>1)return u=p=f=0,e.forEach((e=>{for(;e.call;)e=e();u+=t.scale*(6==drm[1]||14==drm[1]?-1:1)*e[drm[2]]/e[drm[1]],p+=t.scale*e[drm[3]]/e[drm[1]]})),u/=e.length,p/=e.length,e.length>2?`<POLYGON STYLE="pointer-events:none; fill:${d};opacity:0.7" points="${e.map((e=>(6==drm[1]||14==drm[1]?-1:1)*t.scale*e[drm[2]]/e[drm[1]]+","+-t.scale*e[drm[3]]/e[drm[1]]+" "))}"/>`:`<LINE style="pointer-events:none" x1=${t.scale*(6==drm[1]||14==drm[1]?-1:1)*e[0][drm[2]]/e[0][drm[1]]} y1=${-t.scale*e[0][drm[3]]/e[0][drm[1]]} x2=${t.scale*(6==drm[1]||14==drm[1]?-1:1)*e[1][drm[2]]/e[1][drm[1]]} y2=${-t.scale*e[1][drm[3]]/e[1][drm[1]]} stroke="${d||"#888"}"/>`;if("string"==typeof e&&"<"==e[0])return e;if("string"==typeof e){var n="_"==e[0]?"":`<text x="${u}" y="${-p}" font-family="Verdana" font-size="${.1*t.fontSize||.1}" style="pointer-events:none" fill="${d||"#333"}" transform="rotate(${-f},0,0)">&nbsp;${e}&nbsp;</text>`;return p-=.14,n}if("number"==typeof e)return d="#"+(e+(1<<25)).toString(16).slice(-6),"";if(e[v[6]]**2>1e-4){u=t.scale*e[drm[2]]/e[drm[1]],6!=drm[1]&&14!=drm[1]||(u*=-1),p=t.scale*e[drm[3]]/e[drm[1]],f=0;n=`<CIRCLE onmousedown="this.parentElement.sel=${a}" cx="${u}" cy="${-p}" r="${.03*t.pointRadius||.03}" fill="${d||"green"}"/>`;return p+=.05,u-=.1,n}if(e[v[2]]**2+e[v[3]]**2>1e-4){var o=Math.sqrt(e[v[2]]**2+e[v[3]]**2);e[v[2]]/=o,e[v[3]]/=o,e[v[1]]/=o,u=.5,p=t.scale*(drm[1],-1)*e[v[1]],f=-Math.atan2(e[v[2]],e[v[3]])/Math.PI*180;n=`<LINE style="pointer-events:none" x1=-10 y1=${-p} x2=10 y2=${-p} stroke="${d||"#888"}" transform="rotate(${-f},0,0)"/>`;return p+=.05,n}if(e[v[4]]**2+e[v[5]]**2>1e-4){f=0;n=`<LINE style="pointer-events:none" x1=${u+=.1} y1=${-(p+=.05)} x2=${u-e.e02} y2=${-(p+e.e01)} stroke="${d||"#888"}"/>`;return p=p+e.e01/4*3-.05,u-=e.e02/4*3,n}}}})).join()}`,"text/html").body;return c.removeChild(c.firstChild)}e instanceof Function&&(e=e()),e instanceof Array||(e=[].concat.apply([],Object.keys(e).map((t=>"number"==typeof e[t]?[e[t]]:[e[t],t])))),(D=T(e)).value=e,D.options=t,D.setAttribute("stroke-width",.005*t.lineWidth||.005),D.remake=e=>{if(t.animate=e,e){var a=T(r,!D||document.body.contains(D)).innerHTML;D&&(D.innerHTML=a)}return D};var b,E,y=!1;return D.onwheel=e=>{if(e.preventDefault(),t.scale=Math.min(5,Math.max(.1,(t.scale||1)-1e-4*e.deltaY)),!g){var a=T(r,!D||document.body.contains(D)).innerHTML;D&&(D.innerHTML=a)}},D.onmousedown=e=>{e.target==D&&(D.sel=void 0),b=e.clientX,E=e.clientY,y=!0},D.onmousemove=o=>{if(!y||4!=tot||t.conformal){if(void 0!==D.sel&&null!=e[D.sel]&&null!=e[D.sel].set&&o.buttons){var i=D.getBoundingClientRect().width,s=D.getBoundingClientRect().height,l=((o.clientX-D.getBoundingClientRect().left)/(i/4||128)-2)*(i>s?i/s:1),c=((o.clientY-D.getBoundingClientRect().top)/(s/4||128)-2)*(s>i?s/i:1);if(l/=t.scale,c/=t.scale,t.conformal?e[D.sel].set(this.Coeff(1,l,2,-c).Add(n).Add(a.Scale(.5*(l*l+c*c)))):(e[D.sel][drm[2]]=(6==drm[1]?-l:l)-(tot<4?2*t.camera.e01:0),e[D.sel][drm[3]]=-c+(tot<4?2*t.camera.e02:0),e[D.sel][drm[1]]=1,e[D.sel].set(e[D.sel].Normalized)),!g){u=T(r,!D||document.body.contains(D)).innerHTML;D&&(D.innerHTML=u)}D.dispatchEvent(new CustomEvent("input"))}}else{if(!o.buttons)return void(y=!1);var[h,m]=[(t.scale||1)*(o.clientX-b)*3,3*(t.scale||1)*(o.clientY-E)];if([b,E]=[o.clientX,o.clientY],D.sel&&e[D.sel].set?e[D.sel].set(Element.sw(Element.sw(t.camera.Reverse,Element.Bivector(-h/D.clientWidth,m/D.clientHeight,0,0,0,0).Exp()),e[D.sel])):(t.h=(t.h||0)+h/300,t.p=(t.p||0)-m/600,t.camera&&t.camera.set(Element.Bivector(0,0,0,0,0,t.p).Exp().Mul(Element.Bivector(0,0,0,0,t.h,0).Exp()))),!g){var u=T(r,!D||document.body.contains(D)).innerHTML;D&&(D.innerHTML=u)}}},D}l=l||document.createElement("canvas"),i&&(l.width=i),s&&(l.height=s);var M=l.width,A=l.height,_=l.getContext("2d"),x=_.getImageData(0,0,M,A);const[S,L,w,C]=t.range||[-1,1,1,-1];if(2==e.length)for(var R=0;R<M;R++)for(var P=0;P<A;P++){D=(D=e(R/M*(L-S)+S,P/A*(C-w)+w)).buffer?[].slice.call(D):D.slice?D:[D,D,D],x.data.set(D.map((e=>255*e)).concat([255]),P*M*4+4*R)}else if(1==e.length)for(R=0;R<M;R++){var D=e(R/M*(L-S)+S);(D=Math.round((D/(C-w)+-w/(C-w))*A))>0&&D<A-1&&x.data.set([0,0,0,255],D*M*4+4*R)}return _.putImageData(x,0,0),1!=e.length&&2!=e.length||t.grid&&function(){const[e,t]=[e=>(e-S)*M/(L-S),e=>(e-w)*A/(C-w)];_.strokeStyle="#008800",_.lineWidth=1,_.beginPath(),_.moveTo(e(S),t(0)),_.lineTo(e(L),t(0)),_.stroke(),_.moveTo(e(0),t(w)),_.lineTo(e(0),t(C)),_.stroke(),_.strokeStyle="#00FF00",_.lineWidth=2,_.font="10px Arial",_.fillStyle="#448844";for(var r=S,a=w,n=0;n<=10;++n)_.beginPath(),a+=(C-w)/10,r+=(L-S)/10,_.moveTo(e(r),t(-(C-w)/200)),_.lineTo(e(r),t((C-w)/200)),_.stroke(),0!=r.toFixed(1)&&_.fillText(r.toFixed(1),e(r-(L-S)/100),t(-(C-w)/40)),_.moveTo(e((L-S)/200),t(a)),_.lineTo(e(-(L-S)/200),t(a)),_.stroke(),0!=a.toFixed(1)&&_.fillText(a.toFixed(1),e((L-S)/100),t(a))}(),l}static graphGL2(e,t){var r=document.createElement("canvas");r.style.width=t.width||"",r.style.height=t.height||"",r.style.backgroundColor="#EEE",t.width&&t.width.match&&t.width.match(/px/i)&&(r.width=parseFloat(t.width)*(t.devicePixelRatio||devicePixelRatio||1)),t.height&&t.height.match&&t.height.match(/px/i)&&(r.height=parseFloat(t.height)*(t.devicePixelRatio||devicePixelRatio||1));var a=r.getContext("webgl2",{alpha:t.alpha||!1,preserveDrawingBuffer:!0,antialias:!0,powerPreference:"high-performance"}),n=!!a;a||(a=r.getContext("webgl",{alpha:t.alpha||!1,preserveDrawingBuffer:!0,antialias:!0,powerPreference:"high-performance"})),a.clearColor(240/255,240/255,240/255,1),a.enable(a.DEPTH_TEST),n?a.va={createVertexArrayOES:a.createVertexArray.bind(a),bindVertexArrayOES:a.bindVertexArray.bind(a),deleteVertexArrayOES:a.deleteVertexArray.bind(a)}:(a.getExtension("EXT_frag_depth"),a.va=a.getExtension("OES_vertex_array_object"));var o=(e,t)=>{var r=[a.VERTEX_SHADER,a.FRAGMENT_SHADER].map(((r,n)=>{var o=a.createShader(r);return a.shaderSource(o,[e,t][n]),a.compileShader(o),a.getShaderParameter(o,a.COMPILE_STATUS)&&o||console.error(a.getShaderInfoLog(o))})),n=a.createProgram();return a.attachShader(n,r[0]),a.attachShader(n,r[1]),a.linkProgram(n),a.getProgramParameter(n,a.LINK_STATUS)||console.error(a.getProgramInfoLog(n)),n},i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,5,1],s=function(e,t,r,n,o,s,l,c,h,m,u,p){var f;a.useProgram(e),a.uniformMatrix4fv(a.getUniformLocation(e,"mv"),!1,i),a.uniformMatrix4fv(a.getUniformLocation(e,"p"),!1,[5,0,0,0,0,5*(s||1),0,0,0,0,1,2,0,0,-1,0]),a.uniform3fv(a.getUniformLocation(e,"color"),new Float32Array(n)),a.uniform3fv(a.getUniformLocation(e,"color2"),new Float32Array(o)),m&&a.uniform3fv(a.getUniformLocation(e,"color3"),new Float32Array(m)),h&&a.uniform1fv(a.getUniformLocation(e,"b"),new Float32Array(counts[p]).map(((e,t)=>h[p][t]||0))),l&&a.uniform1i(a.getUniformLocation(e,"texc"),0),u&&a.uniform1f(a.getUniformLocation(e,"ratio"),u),c?a.va.bindVertexArrayOESOES(c.r):f=function(e){var t=a.va.createVertexArrayOES();a.va.bindVertexArrayOES(t);var r=a.createBuffer();return a.bindBuffer(a.ARRAY_BUFFER,r),a.bufferData(a.ARRAY_BUFFER,new Float32Array(e),a.STATIC_DRAW),a.vertexAttribPointer(0,3,a.FLOAT,!1,0,0),a.enableVertexAttribArray(0),{r:t,b:r}}(r),a.drawArrays(t,0,c&&c.tcount||r.length/3),f&&function(e){e.b&&a.deleteBuffer(e.b),e.r&&a.va.deleteVertexArrayOES(e.r)}(f)},l=[],c=e=>o(`${n?"#version 300 es":""}\n             ${n?"in":"attribute"} vec4 position; ${n?"out":"varying"} vec4 Pos; uniform mat4 mv; uniform mat4 p;\n             void main() { Pos=mv*position; gl_Position = p*Pos; }`,`${n?"#version 300 es":"#extension GL_EXT_frag_depth : enable"}\n             precision highp float;\n             uniform vec3 color; uniform vec3 color2;\n             uniform vec3 color3; uniform float b[${counts[e]}];\n             uniform float ratio; ${n?"out vec4 col;":""}\n             ${n?"in":"varying"} vec4 Pos;\n             float product_len (in float z, in float y, in float x, in float[${counts[e]}] b) {\n                ${this.nVector(t.up.length>tot?2:1,[])[t.IPNS?"IPNS_GLSL":"OPNS_GLSL"](this.nVector(e,[]),t.up)}\n                return sqrt(abs(sum));\n             }\n             vec3 find_root (in vec3 start, vec3 dir, in float thresh) {\n                vec3 orig=start; \n                float lastd = 1000.0; \n                const int count=${t.maxSteps||80};\n                for (int i=0; i<count; i++) {\n                  float d = product_len(start[0],start[1],start[2],b);\n                  float diff = ${t.stepSize||1e-4}*(1.0+2000.0*d);\n                  if (d < thresh) return start + dir*(lastd-thresh)/(lastd-d)*diff;\n                  lastd = d; start += dir*diff;\n                }\n                return orig;\n             }\n             void main() {\n               vec3 dir = ((-Pos[0]/5.0)*color + color2 + vec3(0.0,Pos[1]/5.0*ratio,0.0)); \n               vec3 p = -5.0*normalize(color2) + dir+vec3(0.0,0.0,1.0); dir = normalize(dir);\n               vec3 L = 5.0*normalize( -0.5*color + 0.85*color2 + vec3(0.0,-0.5,0.0) );\n               vec3 d2 = find_root( p , dir, ${e!=tot-1?t.thresh||.2:"0.0075"} );\n               float dl2 = dot(d2-p,d2-p); const float h=0.0001;\n               if (dl2>0.0) {\n                 vec3 n = normalize(vec3(\n                        product_len(d2[0]+h,d2[1],d2[2],b)-product_len(d2[0]-h,d2[1],d2[2],b),\n                        product_len(d2[0],d2[1]+h,d2[2],b)-product_len(d2[0],d2[1]-h,d2[2],b),\n                        product_len(d2[0],d2[1],d2[2]+h,b)-product_len(d2[0],d2[1],d2[2]-h,b)\n                      ));\n                 ${n?"gl_FragDepth":"gl_FragDepthEXT"} = dl2/50.0;\n                 ${n?"col":"gl_FragColor"} = vec4(max(0.2,abs(dot(n,normalize(L-d2))))*color3 + pow(abs(dot(n,normalize(normalize(L-d2)+dir))),100.0),1.0);\n               } else discard;\n             }`),h=e=>o(`${n?"#version 300 es":""}\n             ${n?"in":"attribute"} vec4 position; ${n?"out":"varying"} vec4 Pos; uniform mat4 mv; uniform mat4 p;\n             void main() { Pos=mv*position; gl_Position = p*Pos; }`,`${n?"#version 300 es":"#extension GL_EXT_frag_depth : enable"}\n             precision highp float;\n             uniform vec3 color; uniform vec3 color2;\n             uniform vec3 color3; uniform float b[${counts[e]}];\n             uniform float ratio; ${n?"out vec4 col;":""}\n             ${n?"in":"varying"} vec4 Pos;\n             float product_len (in float z, in float y, in float x, in float[${counts[e]}] b) {\n                ${this.nVector(1,[])[t.IPNS?"IPNS_GLSL":"OPNS_GLSL"](this.nVector(e,[]),t.up)}\n                return sqrt(abs(sum));\n             }\n             void main() {\n               vec3 p = -5.0*normalize(color2) -Pos[0]/5.0*color + color2 + vec3(0.0,Pos[1]/5.0*ratio,0.0); \n               float d2 = 1.0 - 150.0*pow(product_len( p[0]*5.0, p[1]*5.0, p[2]*5.0, b),2.0);\n               if (d2>0.0) {\n                 ${n?"col":"gl_FragColor"} = vec4(color3,d2);\n               } else discard;\n             }`),m=0;r.update=n=>{var o=getComputedStyle(r);o.width&&(r.width=parseFloat(o.width)*(t.devicePixelRatio||devicePixelRatio||1),r.height=parseFloat(o.height)*(t.devicePixelRatio||devicePixelRatio||1)),a.viewport(0,0,0|r.width,0|r.height);var i=r.width/r.height,u=[.5,.5,.5];for(a.clear(a.COLOR_BUFFER_BIT+a.DEPTH_BUFFER_BIT);n.call;)n=n();for(var p=0,f=n.length;p<f;p++){for(var d=n[p];d&&d.call;)d=d();if(null!=d&&("number"==typeof d&&((d>>>24&255)/255,u[0]=(d>>>16&255)/255,u[1]=(d>>>8&255)/255,u[2]=(255&d)/255),d instanceof Element)){var g=t.spin?-performance.now()*t.spin/1e3:-t.h||0;g+=Math.PI/2;i=r.height/r.width;for(var v=tot-1;!d[v]&&v>1;)v--;l[tot-1-v]||(l[tot-1-v]=t.up.find((e=>e.match&&e.match("z")))?c(v):h(v)),a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),s(l[tot-1-v],a.TRIANGLES,[-2,-2,0,-2,2,0,2,-2,0,-2,2,0,2,-2,0,2,2,0],[Math.cos(g),0,-Math.sin(g)],[Math.sin(g),0,Math.cos(g)],void 0,void 0,void 0,d,u,i,v),a.disable(a.BLEND)}}m++,document.body.contains(r)&&(m=0),2!=m&&(r.value=n,t&&!t.animate&&r.dispatchEvent(new CustomEvent("input")),t&&t.animate&&requestAnimationFrame(r.update.bind(r,e,t)),t&&t.still&&(r.value=n,r.dispatchEvent(new CustomEvent("input")),r.im.width=r.width,r.im.height=r.height,r.im.src=r.toDataURL()))};var u=-1;if(r.oncontextmenu=r.onmousedown=a=>{a.preventDefault(),a.stopPropagation(),u=-2;var n=r.getBoundingClientRect();a.x,n.left,n.right,n.left,a.y,n.top,n.bottom,n.top,r.height,r.width;r.onwheel=a=>{a.preventDefault(),a.stopPropagation(),t.z=(t.z||5)+a.deltaY/100,t.animate||requestAnimationFrame(r.update.bind(r,e,t))},r.onmouseup=e=>u=-1,r.onmouseleave=e=>u=-1,r.onmousemove=a=>{var n=r.getBoundingClientRect(),o=a.movementX/(n.right-n.left)*2;a.movementY,n.bottom,n.top,r.height,r.width;if(-2==u)return t.h=(t.h||0)+o,void(t.animate||requestAnimationFrame(r.update.bind(r,e,t)))}},r.value=e.call?e():e,r.options=t,t&&t.still){var p=new Image;return r.im=p,requestAnimationFrame(r.update.bind(r,e,t)),p}return requestAnimationFrame(r.update.bind(r,e,t)),r}static graphGL(e,t){var a=document.createElement("canvas");a.style.width=t.width||"",a.style.height=t.height||"",a.style.backgroundColor="#EEE",t.width&&t.width.match&&t.width.match(/px/i)&&(a.width=parseFloat(t.width)),t.height&&t.height.match&&t.height.match(/px/i)&&(a.height=parseFloat(t.height));var n=a.getContext("webgl",{alpha:t.alpha||!1,antialias:!0,preserveDrawingBuffer:t.still||!0,powerPreference:"high-performance"});n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),t.alpha||n.clearColor(240/255,240/255,240/255,1),n.getExtension("OES_standard_derivatives"),n.va=n.getExtension("OES_vertex_array_object");var o=(e,t)=>{var r=[n.VERTEX_SHADER,n.FRAGMENT_SHADER].map(((r,a)=>{var o=n.createShader(r);return n.shaderSource(o,[e,t][a]),n.compileShader(o),n.getShaderParameter(o,n.COMPILE_STATUS)&&o||console.error(n.getShaderInfoLog(o))})),a=n.createProgram();return n.attachShader(a,r[0]),n.attachShader(a,r[1]),n.linkProgram(a),n.getProgramParameter(a,n.LINK_STATUS)||console.error(n.getProgramInfoLog(a)),a},i=function(e,t,r,a){var o=n.va.createVertexArrayOES();n.va.bindVertexArrayOES(o);var i=n.createBuffer();if(n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,new Float32Array(e),n.STATIC_DRAW),n.vertexAttribPointer(0,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(0),t){var s=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,s),n.bufferData(n.ARRAY_BUFFER,new Float32Array(t),n.STATIC_DRAW),n.vertexAttribPointer(1,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(1)}if(a){var l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,l),n.bufferData(n.ARRAY_BUFFER,new Float32Array(a),n.STATIC_DRAW),n.vertexAttribPointer(t?2:1,3,n.FLOAT,!1,0,0),n.enableVertexAttribArray(t?2:1)}if(r){var c=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,c),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),n.STATIC_DRAW)}return{r:o,b:i,b2:s,b4:c,b3:l}},s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,5,1],l=(e,r=!0)=>{var a=t.spin?performance.now()*t.spin/1e3:-t.h||0,n=t.p||0,o=Math.cos(a),i=Math.sin(a),s=Math.cos(n),l=Math.sin(n),c=t.posx||0,h=t.posy||0,m=t.posz||0,u=t.z||5;if(5==tot)return[o,i*-l,i*s,0,0,s,l,0,-i,o*-l,o*s,0,c*o+m*-i,h*s+(c*i+m*o)*-l,h*l+c*i+m*o*s+u,1];h=(e=e.Normalized).Mul(e.Dual);var p=e.e23,f=-e.e13,d=-e.e12,g=e.s,v=p*f,b=p*d,E=p*g,y=f*f,M=f*d,A=f*g,_=d*d,x=d*g;return[1-2*(y+_),2*(v+x),2*(b-A),0,2*(v-x),1-2*((c=p*p)+_),2*(M+E),0,2*(b+A),2*(M-E),1-2*(c+y),0,-2*h.e23,-2*h.e13,2*h.e12+(r?5:0),1]},c=function(e,r,a,o,l,c,h,m,u,p=!0){var f;n.useProgram(e),n.uniformMatrix4fv(n.getUniformLocation(e,"mv"),!1,s),n.uniformMatrix4fv(n.getUniformLocation(e,"p"),!1,[5,0,0,0,0,5*(c||2),0,0,0,0,1,2,0,0,-1,0]),n.uniform3fv(n.getUniformLocation(e,"color"),new Float32Array(o)),n.uniform3fv(n.getUniformLocation(e,"color2"),new Float32Array(l)),m?n.va.bindVertexArrayOES(m.r):f=i(a,h,void 0,u),t.cull&&p&&n.enable(n.CULL_FACE),m&&m.b4?n.drawElements(r,m.tcount,n.UNSIGNED_SHORT,0):n.drawArrays(r,0,m&&m.tcount||a.length/3),f&&function(e){[e.b,e.b2,e.b4,e.b3].forEach((e=>{e&&n.deleteBuffer(e)})),e.r&&n.va.deleteVertexArrayOES(e.r)}(f),t.cull&&n.disable(n.CULL_FACE)},h=o("attribute vec4 position; varying vec4 Pos; uniform mat4 mv; uniform mat4 p;\n                 void main() { gl_PointSize=12.0; Pos=mv*position; gl_Position = p*Pos; }","#extension GL_OES_standard_derivatives : enable\n                 precision highp float; uniform vec3 color; uniform vec3 color2; varying vec4 Pos;\n                 void main() { vec3 ldir = normalize(Pos.xyz - vec3(2.0,2.0,-4.0));\n                 vec3 normal = normalize(cross(dFdx(Pos.xyz), dFdy(Pos.xyz))); float l=dot(normal,ldir);\n                 vec3 E = normalize(-Pos.xyz); vec3 R = normalize(reflect(ldir,normal));\n                 gl_FragColor = vec4(max(0.0,l)*color+vec3(0.5*pow(max(dot(R,E),0.0),20.0))+color2, 1.0);  }"),m=o("attribute vec4 position; varying vec4 Pos; varying vec3 N; uniform mat4 mv; uniform mat4 p;\n                 void main() { gl_PointSize=12.0; Pos=mv*position; N = normalize(position.xzy); gl_Position = p*Pos; }","#extension GL_OES_standard_derivatives : enable\n                 precision highp float; uniform vec3 color; uniform vec3 color2; varying vec4 Pos; varying vec3 N;\n                 void main() { vec3 ldir = normalize(Pos.xyz - vec3(2.0,2.0,-4.0));\n                 vec3 normal = N; float l=dot(normal,ldir);\n                 vec3 E = normalize(-Pos.xyz); vec3 R = normalize(reflect(ldir,normal));\n                 gl_FragColor = vec4(max(0.0,l)*color+vec3(0.5*pow(max(dot(R,E),0.0),20.0))+color2, 1.0);  }"),u=o(`attribute vec4 position; varying vec4 Pos; uniform mat4 mv; uniform mat4 p;\n                 void main() { gl_PointSize=${((t.pointRadius||1)*(t.devicePixelRatio||devicePixelRatio||1)*8).toFixed(2)}; Pos=mv*position; gl_Position = p*Pos; }`,"precision highp float; uniform vec3 color; uniform vec3 color2; varying vec4 Pos;\n                 void main() {  float distanceToCenter = length(gl_PointCoord - vec2(0.5)); if (distanceToCenter>0.5) discard; \n                 gl_FragColor = vec4(color+color2, (distanceToCenter<0.5?1.0:0.0));  }"),p=o("\n                 attribute vec4 position;  // current point.\n                 attribute vec2 texc;      // x = +w or -w, alternating. y = opacity.\n                 attribute vec4 col;       // next point. (extrapolated for end point)\n                 uniform vec3 color;       // r=aspect g=thickness\n                 uniform mat4 mv,p;        // modelview and projection matrix\n                 varying vec2 tc;\n                 void main() { \n                 // Convert to clipspace.\n                   vec4 cp = p*mv*vec4(position.xyz,1.0);\n                   vec2 cs = cp.xy / abs(cp.w);\n                   vec4 np = p*mv*vec4(col.xyz,1.0);\n                   vec2 ns = np.xy / abs(np.w);\n                 // compensate aspect\n                   cs.x *= color.r;\n                   ns.x *= color.r; \n                 // clipspace line direction.\n                   vec2 dir = normalize(cs-ns);\n                 // Calculate screenspace normal.\n                   vec2 normal = vec2( -dir.y, dir.x); \n                 // Line scaling and aspect fix.\n                   normal *= color.g * 5.0;\n                   normal.x /= color.r;\n                 // Pass through texture coordinates for edge softening  \n                   tc = vec2(texc.x / abs(texc.x), texc.y);\n                   gl_Position = cp + vec4(normal*texc.x,0.0,0.0);\n                 }","precision highp float; \n                 uniform vec3 color2; \n                 varying vec2 tc; \n                 void main() { \n//                   gl_FragColor = vec4(abs(tc.x),abs(tc.x),abs(tc.x),1.0-abs(tc.x)); \n                   gl_FragColor = vec4(color2,(1.0-pow(abs(tc.x),2.0))*tc.y); \n                 }"),f=o("attribute vec4 position; attribute vec3 col; varying vec3 Col; varying vec4 Pos; uniform mat4 mv; uniform mat4 p;\n                 void main() { gl_PointSize=6.0; Pos=mv*position; gl_Position = p*Pos; Col=col; }",`#extension GL_OES_standard_derivatives : enable\n                 precision highp float; uniform vec3 color; uniform vec3 color2; varying vec4 Pos; varying vec3 Col;\n                 void main() { vec3 ldir = normalize(Pos.xyz - vec3(1.0,1.0,2.0));\n                 vec3 normal = normalize(cross(dFdx(Pos.xyz), dFdy(Pos.xyz))); float l=dot(normal,ldir);\n                 vec3 E = normalize(-Pos.xyz); vec3 R = normalize(reflect(ldir,normal));\n                 gl_FragColor = vec4(max(0.3,l)*Col+vec3(pow(max(dot(R,E),0.0),20.0))+color2, 1.0); ${t.shader||""}  }`),d=o("attribute vec4 position; attribute vec2 texc; attribute vec3 col; varying vec3 Col; varying vec4 Pos; uniform mat4 mv; uniform mat4 p; uniform vec3 color2;\n                 void main() { gl_PointSize=2.0; float blend=fract(color2.x+texc.r)*0.5; Pos=mv*(position*(1.0-blend) + (blend)*vec4(col,1.0)); gl_Position = p*Pos; Col=vec3(length(col-position.xyz)*1.); gl_PointSize = 8.0 -  Col.x; Col.y=sin(blend*2.*3.1415); }","precision highp float; uniform vec3 color; uniform vec3 color2; varying vec4 Pos; varying vec3 Col; \n                 void main() {  float distanceToCenter = length(gl_PointCoord - vec2(0.5));gl_FragColor = vec4(1.0-pow(Col.x,2.0),0.0,0.0,(.6-Col.x*0.05)*(distanceToCenter<0.5?1.0:0.0)*Col.y);  }");n.lineWidth(t.lineWidth||1);var g=Object.assign(document.createElement("canvas"),{width:3729,height:48}),v=Object.assign(g.getContext("2d"),{font:"bold 48px lucida console, monospace"}),b=n.createTexture();n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,b);for(var E=33;E<127;E++)v.fillText(String.fromCharCode(E),33*(E-33),40);var y="";y.split("").forEach(((e,t)=>v.fillText(e,33*(t-33+127),40))),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,g),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE);var M=o("attribute vec4 position; attribute vec2 texc; varying vec2 tex; varying vec4 Pos; uniform mat4 mv; uniform mat4 p; uniform vec3 color2;\n                 void main() { tex=texc; gl_PointSize=6.0; vec4 o=mv*vec4(color2,0.0); Pos=(-1.0/(o.z-mv[3][2]))*position+vec4(mv[3][0],mv[3][1],mv[3][2],0.0)+o; gl_Position = p*Pos; }","precision highp float; uniform vec3 color; varying vec4 Pos; varying vec2 tex;\n                 uniform sampler2D texm; void main() { vec4 c = texture2D(texm,tex); if (c.a<0.01) discard; gl_FragColor = vec4(color,c.a);}");const A=([e,t,r,a,n,o])=>[e,t,r,e,t,r,a,n,o,a,n,o,e,t,r,a,n,o],_=([e,t,r,a,n,o])=>[a,n,o,a,n,o,2*a-e,2*n-t,2*o-r,2*a-e,2*n-t,2*o-r,a,n,o,2*a-e,2*n-t,2*o-r];if(5==tot&&t.conformal)var x=Element.Coeff(4,1).Add(Element.Coeff(5,1)),S=Element.Coeff(4,.5).Sub(Element.Coeff(5,.5));var L,w=e=>{if(!(e instanceof Element))return{tp:0};t.ipns&&(e=e.Dual);var r,a,n,o,i,s,l=e.Mul(e).s,c=0,h=x.Wedge(e),m=x.LDot(e),u=1e-6/(t.scale||1),p=Element.Coeff(16,-1),f=Math.abs(l)<u,d=m.VLength<u,g=h.VLength<u;if(g&&d);else if(g&&!d)if(a=S.Wedge(x).LDot(e),r=Math.abs(a.LDot(a).s)**.5,n=[-(n=a.LDot(e.Reverse)).e15/n.e45,-n.e25/n.e45,-n.e34/n.e45],e.Grade(3).VLength)o=[a.e1/r,a.e2/r,a.e3/r],c=2;else if(e.Grade(2).VLength)c=1;else{-1==(v=(o=Element.LDot(Element.Mul(a,1/r),p).Normalized).Mul(Element.Coeff(3,1)))[0]?v[0]=1:(v[0]+=1,v=v.Normalized),i=[...v.Mul(Element.Coeff(1,1)).Mul(v.Conjugate)].slice(1,4),s=[...v.Mul(Element.Coeff(2,1)).Mul(v.Conjugate)].slice(1,4),o=[...o.slice(1,4)],c=3}else if(!g&&d);else if(f)t.ipns&&(e=e.Dual),a=x.Wedge(S).LDot(x.Wedge(e)),n=[...Element.LDot(1/x.LDot(e).s,e).slice(1,4)].map((e=>-e)),c=1;else if(!f){c=e.Grade(3).VLength?4:e.Grade(2).VLength?6:5;var v,b=x.Wedge(e),E=b.Mul(b).s;if(a=x.Wedge(S).LDot(b),n=[...e.Mul(x).Mul(e).slice(1,4)].map((e=>-e/(2*E))),r=Math.abs(e.LDot(e).s/E)**.5,4==c)e.LDot(e).s<0&&(r=-r),-1==(v=(o=Element.LDot(Element.Mul(a,1/r),p).Normalized).Mul(Element.Coeff(3,1)))[0]?v[0]=1:(v[0]+=1,v=v.Normalized),i=[...v.Mul(Element.Coeff(1,1)).Mul(v.Conjugate)].slice(1,4),s=[...v.Mul(Element.Coeff(2,1)).Mul(v.Conjugate)].slice(1,4),o=[...o.slice(1,4)];else 6==c?(r=e.LDot(e).s<0?-r:r,o=Element.Mul(a.Normalized,r).slice(1,4)):o=[...Element.LDot(Element.Mul(a,1/r),p).Normalized.slice(1,4)]}return{tp:c,pos:n?n.map((e=>e*(t.scale||1))):[0,0,0],normal:o,tg:i,btg:s,weight2:r*(t.scale||1)}},C=0,R=Element.Coeff(14,1);a.update=r=>{if(a.parentElement){t&&!t.still&&a.im&&a.im.parentElement&&(a.im.parentElement.insertBefore(a,a.im),a.im.parentElement.removeChild(a.im));var o=getComputedStyle(a);o.width&&(a.width=parseFloat(o.width)*(t.devicePixelRatio||devicePixelRatio||1),a.height=parseFloat(o.height)*(t.devicePixelRatio||devicePixelRatio||1)),n.viewport(0,0,0|a.width,0|a.height);var g,v=a.width/a.height,b=[],E=[],x=[],P=[.5,.5,.5],D=0,T=[-2,2,.2,1];for(n.clear(n.COLOR_BUFFER_BIT+n.DEPTH_BUFFER_BIT);r.call;)r=r();if(s=l(t.camera),T=t.camera.Conjugate.Mul(((g=new this).set(T,11),g)).Mul(t.camera).slice(11,14),t.grid){const Fe=t.gridSize||1;if(!t.gridLines){t.gridLines=[[],[],[]];for(var $=-Fe;$<=Fe;$+=Fe/10)t.gridLines[0].push($,-Fe,Fe,$,-Fe,-Fe,Fe,-Fe,$,-Fe,-Fe,$),t.gridLines[1].push($,Fe,Fe,$,-Fe,Fe,Fe,$,Fe,-Fe,$,Fe),t.gridLines[2].push(-Fe,$,Fe,-Fe,$,-Fe,-Fe,Fe,$,-Fe,-Fe,$)}for(var N=[],F=[],I=[],z=0;z<3;++z)for($=0;$<t.gridLines[z].length;$+=6){N.push(...A(t.gridLines[z].slice($,$+6))),F.push(..._(t.gridLines[z].slice($,$+6)));var O=($/12|0)%10==0?2:($/12|0)%5==0?1.5:.75;I.push(O,.5,-O,.5,O,.5,O,.5,-O,.5,-O,.5)}n.depthMask(!1),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND),c(p,n.TRIANGLES,N,[a.width/a.height,.003,0],[0,0,0],a.width/a.height,I,void 0,F,!1),n.depthMask(!0),n.disable(n.BLEND)}t.noZ&&n.depthMask(!1);$=0;for(var j=r.length;$<j;$++){for(var B=r[$];B&&B.call&&0==B.length;)B=B();if(null!=B)if(5==tot&&t.conformal){if(B instanceof Array&&2==B.length){B.forEach((e=>{for(;e.call;)e=e.call();e=w(e),E.push.apply(E,e.pos)}));var V={tp:-1}}else if(B instanceof Array&&3==B.length){B.forEach((e=>{for(;e.call;)e=e.call();e=w(e),x.push.apply(x,e.pos)}));V={tp:-1}}else V=w(B);if(V.tp&&(T=V.pos),1==V.tp&&b.push.apply(b,V.pos),2==V.tp&&(E.push.apply(E,V.pos.map(((e,t)=>e-3*V.normal[t]))),E.push.apply(E,V.pos.map(((e,t)=>e+3*V.normal[t])))),3==V.tp&&(x.push.apply(x,V.pos.map(((e,t)=>e+V.tg[t]+V.btg[t]))),x.push.apply(x,V.pos.map(((e,t)=>e-V.tg[t]+V.btg[t]))),x.push.apply(x,V.pos.map(((e,t)=>e+V.tg[t]-V.btg[t]))),x.push.apply(x,V.pos.map(((e,t)=>e-V.tg[t]+V.btg[t]))),x.push.apply(x,V.pos.map(((e,t)=>e+V.tg[t]-V.btg[t]))),x.push.apply(x,V.pos.map(((e,t)=>e-V.tg[t]-V.btg[t])))),4==V.tp){var U=0,k=0;V.weight2<0&&(P[0]=1,P[1]=0,P[2]=0);for(z=0;z<65;z++)U=V.pos.map(((e,t)=>e+Math.cos(z/32*Math.PI)*V.weight2*V.tg[t]+Math.sin(z/32*Math.PI)*V.weight2*V.btg[t])),U&&k&&(V.weight2>0||z%2==0)&&(E.push.apply(E,k),E.push.apply(E,U)),k=U}if(6==V.tp&&(V.weight2<0&&(P[0]=1,P[1]=0,P[2]=0),t.useUnnaturalLineDisplayForPointPairs&&(E.push.apply(E,V.pos.map(((e,r)=>e-V.normal[r]*(t.scale||1)))),E.push.apply(E,V.pos.map(((e,r)=>e+V.normal[r]*(t.scale||1))))),b.push.apply(b,V.pos.map(((e,r)=>e-V.normal[r]*(t.scale||1)))),b.push.apply(b,V.pos.map(((e,r)=>e+V.normal[r]*(t.scale||1))))),5==V.tp){if(!L){var G=[],H=[],q=Math.sin,W=Math.cos,Y=Math.PI,X=48;for(z=0;z<97;z++)for(var Q=0;Q<X;Q++)G.push([q(2*Y*z/96)*q(Y*Q/47),W(2*Y*z/96)*q(Y*Q/47),W(Y*Q/47)]),z&&Q&&(H.push.apply(H,G[(z-1)*X+Q-1]),H.push.apply(H,G[(z-1)*X+Q]),H.push.apply(H,G[z*X+Q-1]),H.push.apply(H,G[z*X+Q-1]),H.push.apply(H,G[(z-1)*X+Q]),H.push.apply(H,G[z*X+Q]));(L={va:i(H,void 0)}).va.tcount=H.length/3}var K=s;s=[].concat.apply([],Element.Mul([[V.weight2,0,0,0],[0,V.weight2,0,0],[0,0,V.weight2,0],[V.pos[0],V.pos[1],V.pos[2],1]],[[s[0],s[1],s[2],s[3]],[s[4],s[5],s[6],s[7]],[s[8],s[9],s[10],s[11]],[s[12],s[13],s[14],s[15]]])).map((e=>e.s)),n.enable(n.BLEND),n.blendFunc(n.CONSTANT_ALPHA,n.ONE_MINUS_CONSTANT_ALPHA),n.blendColor(1,1,1,1-(D||.1)),n.enable(n.CULL_FACE),c(m,n.TRIANGLES,void 0,P,[0,0,0],v,void 0,L.va),n.disable(n.BLEND),n.disable(n.CULL_FACE),s=K}if($==j-1||0==V.tp){if(D&&(n.enable(n.BLEND),n.blendFunc(n.CONSTANT_ALPHA,n.ONE_MINUS_CONSTANT_ALPHA),n.blendColor(1,1,1,1-D)),x.length&&(c(h,n.TRIANGLES,x,P,[0,0,0],v),x.forEach(((e,t)=>{t%9==0&&(T=[0,0,0]),T[t%3]+=e/3})),x=[]),E.length){N=[],F=[],I=[];for(var Z=0;Z<E.length;Z+=6){N.push(...A(E.slice(Z,Z+6))),F.push(..._(E.slice(Z,Z+6)));O=t.lineWidth||1;I.push(O,1-D,-O,1-D,O,1-D,O,1-D,-O,1-D,-O,1-D)}n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND),n.depthMask(!1),c(p,n.TRIANGLES,N,[a.width/a.height,.003,0],P,a.width/a.height,I,void 0,F,!1);var J=E.length-1;T=[(E[J-2]+E[J-5])/2,(E[J-1]+E[J-4])/2+.1,(E[J]+E[J-3])/2],E=[],n.depthMask(!0),n.disable(n.BLEND)}if(b.length&&(n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),c(u,n.POINTS,b,[0,0,0],P,v),(T=b.slice(-3))[0]-=.075,T[1]+=.075,b=[],n.disable(n.BLEND)),B.call&&2==B.length&&!B.va3){for(var ee=B.dx||32,te=B.dy||32,re=new Float32Array(3*ee*te),ae=new Float32Array(3),ne=[],oe=0,ie=0;ie<ee;ie++)for(var se=0;se<te;se++,oe+=3)re.set(Element.sw(B(ie/(ee-1),se/(te-1)),S).slice(1,4),oe);for(ie=0;ie<ee-1;ie++)for(se=0;se<te;se++)ne.push((ie+0)*te+(se+0),(ie+0)*te+(se+1),(ie+1)*te+(se+1),(ie+0)*te+(se+0),(ie+1)*te+(se+1),(ie+1)*te+(se+0));B.va3=i(re,void 0,ne.map((e=>e%(ee*te)))),B.va3.tcount=(ee-1)*te*2*3}if(B.call&&1==B.length&&!B.va2){for(ee=B.dx||256,re=new Float32Array(3*ee),ae=new Float32Array(3),ne=[],ie=0;ie<ee;ie++)re.set(Element.sw(B(ie/(ee-1)),S).slice(1,4),3*ie),ie&&ne.push(ie-1,ie);B.va2=i(re,void 0,ne),B.va2.tcount=ne.length}if(B instanceof Object&&B.motor){if(!B.va||B.recalc){var le=1;function ze(){var e=1e4*Math.sin(le++);return e-Math.floor(e)}B.xRange=void 0===B.xRange?1:B.xRange,B.yRange=void 0===B.yRange?1:B.yRange,B.zRange=void 0===B.zRange?1:B.zRange;var ce=[],he=[],me=[];for($=0;$<(B.zRange*B.xRange*B.yRange==0?2500:12e3*Math.pow(B.zRange*B.xRange*B.yRange,1/3));$++){var[r,ue,pe]=[ze()*(2*B.xRange)-B.xRange,2*ze()*B.yRange-B.yRange,2*ze()*B.zRange-B.zRange],fe=.5*(r*r+ue*ue+pe*pe),b=Element.Vector(r,ue,pe,fe-.5,fe+.5);V=(Pe=Element.sw(B.motor,b))[5]-Pe[4];Pe[1]/=V,Pe[2]/=V,Pe[3]/=V,he.push(ze(),ze()),ce.push(...b.slice(1,4)),me.push(...Pe.slice(1,4))}B.va=i(ce,he,void 0,me),B.va.tcount=ce.length/3,B.recalc=!1}var de=performance.now()/1e3;n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.disable(n.DEPTH_TEST),c(d,n.POINTS,x,P,[de%1,0,0],v,void 0,B.va),n.disable(n.BLEND),n.enable(n.DEPTH_TEST)}else if(B.va||B.va2||B.va3||B instanceof Object&&B.data){if(!B.va3&&!B.va2){ne=[];var ge=[],ve=[],be=0,Ee=0,ye=0;B.data.forEach((e=>{if(e instanceof Array&&3==e.length){ye++,e.forEach((e=>{for(;e.call;)e=e.call();e=w(e),ve.push.apply(ve,e.pos)}));var t={tp:-1}}else{1==(t=w(e)).tp&&(Ee++,ne.push(...t.pos)),2==t.tp&&(be++,ge.push(...t.pos.map(((e,r)=>e-10*t.normal[r])),...t.pos.map(((e,r)=>e+10*t.normal[r]))))}})),B.va=i(ne,void 0),B.va.tcount=Ee,B.va2=i(ge,void 0),B.va2.tcount=2*be,B.va3=i(ve,void 0),B.va3.tcount=3*ye}B.va&&B.va.tcount&&(n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),c(u,n.POINTS,void 0,[0,0,0],P,v,void 0,B.va),n.disable(n.BLEND)),B.va2&&B.va2.tcount&&c(h,n.LINES,void 0,[0,0,0],P,v,void 0,B.va2),B.va3&&B.va3.tcount&&c(h,n.TRIANGLES,void 0,P,[0,0,0],v,void 0,B.va3)}if(D&&n.disable(n.BLEND),"number"==typeof B&&(D=(B>>>24&255)/255,P[0]=(B>>>16&255)/255,P[1]=(B>>>8&255)/255,P[2]=(255&B)/255),"string"==typeof B)if(t.htmlText){r["_"+$]||(console.log("creating div"),Object.defineProperty(r,"_"+$,{value:document.body.appendChild(document.createElement("div")),enumerable:!1}));var Me=a.getBoundingClientRect(),Ae=r["_"+$],_e=Element.Mul([[s[0],s[4],s[8],s[12]],[s[1],s[5],s[9],s[13]],[s[2],s[6],s[10],s[14]],[s[3],s[7],s[11],s[15]]],[...T,1]).map((e=>e.s));_e=Element.Mul([[5,0,0,0],[0,5*(v||2),0,0],[0,0,1,-1],[0,0,2,0]],_e).map((e=>e.s)).map(((e,t,r)=>e/r[3])),Object.assign(Ae.style,{position:"fixed",pointerEvents:"none",left:Me.left+(Me.right-Me.left)*(_e[0]/2+.5),top:Me.top+(Me.bottom-Me.top)*(-_e[1]/2+.5)-20}),Ae.last!=B&&(Ae.innerHTML=B,Ae.last=B,self.renderMathInElement&&self.renderMathInElement(Ae))}else{n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA);var xe=113,Se=e=>{var t=e.charCodeAt(0)-33;return t>=94&&(t=94+y.indexOf(e)),t/xe};c(M,n.TRIANGLES,[...Array(6*B.length*3)].map(((e,r)=>{var a=-.2,n=0+1.1*(r/18|0);return.05*(t.z||5)*[n,-1,a,n+1.2,-1,a,n,1,a,n+1.2,-1,a,n+1.2,1,a,n,1,a][r%18]})),P,T,v,[...Array(6*B.length*2)].map(((e,t)=>{var r=Se(B[t/12|0]);return[r,1,r+1/xe,1,r,0,r+1/xe,1,r+1/xe,0,r,0][t%12]}))),n.disable(n.BLEND),T[1]-=.18}}}else{if(t.dual&&B instanceof Element&&(B=B.Dual),B instanceof Element&&B.Grade(1).Length>.001){var Le=Element.Add(1,Element.Mul(B.Normalized,Element.Coeff(3,1))).Normalized;B=Element.sw(Le,[[-1,-1],[-1,1],[1,1],[-1,-1],[1,1],[1,-1]].map((([e,t])=>Element.Trivector(e*B.Length,0,t*B.Length,1))))}if(B instanceof Element&&B.Grade(2).Length&&(B=[B.LDot(R).Wedge(B).Add(B.Wedge(Element.Coeff(1,1)).Mul(Element.Coeff(0,-(t.clip||3)))),B.LDot(R).Wedge(B).Add(B.Wedge(Element.Coeff(1,1)).Mul(Element.Coeff(0,t.clip||3)))].map((e=>e[14]<0?e.Scale(-1):e))),B.e123&&b.push.apply(b,B.slice(11,14).map(((e,t)=>(t<=1?1:-1)*e/B[14])).reverse()),B instanceof Array&&2==B.length&&(E=E.concat.apply(E,B.map((e=>[...e.slice(11,14).map(((t,r)=>(r<=1?1:-1)*t/e[14])).reverse()])))),B instanceof Array&&B.length%3==0&&(x=x.concat.apply(x,B.map((e=>[...e.slice(11,14).map(((t,r)=>(r<=1?1:-1)*t/e[14])).reverse()])))),B.call&&1==B.length){var we,Ce,Re=B.dx||64;for(ae=new Float32Array(3),ie=0;ie<Re;ie++){ie>1&&E.push(Ce[0],Ce[1],Ce[2]);Le=B(ie/(Re-1));0==ie&&(we=Le[0]||Le[5]||Le[6]||Le[7]||Le[8]||Le[9]||Le[10]),Ce=we?Ie(Le,ae):Le.slice(11,14).map(((e,t)=>(t<=1?1:-1)*e)).reverse(),E.push(Ce[0],Ce[1],Ce[2])}}if(B.call&&2==B.length&&!B.va){for(ee=B.dx||64,te=B.dy||32,re=new Float32Array(3*ee*te),ae=new Float32Array(3),ne=[],oe=0,ie=0;ie<ee;ie++)for(se=0;se<te;se++,oe+=3)re.set(Ie(B(ie/(ee-1),se/(te-1)),ae),oe);for(ie=0;ie<ee-1;ie++)for(se=0;se<te;se++)ne.push((ie+0)*te+(se+0),(ie+0)*te+(se+1),(ie+1)*te+(se+1),(ie+0)*te+(se+0),(ie+1)*te+(se+1),(ie+1)*te+(se+0));B.va=i(re,void 0,ne.map((e=>e%(ee*te)))),B.va.tcount=(ee-1)*te*2*3}if(B instanceof Object&&B.motor){if(!B.va||B.recalc){le=1;function Oe(){var e=1e4*Math.sin(le++);return e-Math.floor(e)}B.xRange=void 0===B.xRange?1:B.xRange,B.yRange=void 0===B.yRange?1:B.yRange,B.zRange=void 0===B.zRange?1:B.zRange;for(ce=[],he=[],me=[],$=0;$<(0===B.zRange?5e3:6e4);$++){b=Element.Trivector(Oe()*(2*B.xRange)-B.xRange,2*Oe()*B.yRange-B.yRange,2*Oe()*B.zRange-B.zRange,1);var Pe=B.motor.Mul(b).Mul(B.motor.Inverse);he.push(Oe(),Oe()),ce.push(...b.slice(11,14).reverse()),me.push(...Pe.slice(11,14).reverse())}B.va=i(ce,he,void 0,me),B.va.tcount=ce.length/3,B.recalc=!1}de=performance.now()/1e3;n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.disable(n.DEPTH_TEST),c(d,n.POINTS,x,P,[de%1,0,0],v,void 0,B.va),n.disable(n.BLEND),n.enable(n.DEPTH_TEST)}else if(B.va||B instanceof Object&&B.data){if(!B.va){if(B.idx)ne=B.data.map((e=>[...e.slice(11,14).map(((t,r)=>(r<=1?1:-1)*t/e[14])).reverse()])).flat();else{ne=[];B.data.forEach((e=>{e instanceof Array&&3==e.length&&(ne=ne.concat.apply(ne,e.map((e=>[...e.slice(11,14).map(((t,r)=>(r<=1?1:-1)*t/e[14])).reverse()]))))}))}B.va=i(ne,void 0,B.idx,B.color?new Float32Array(B.color):void 0),B.va.tcount=B.idx&&B.idx.length?B.idx.length:3*B.data.length}var De=Element.Scalar(1).Add(Element.Coeff(7,2.5));if(B.transform){var Te=l(B.transform,!1),$e=l(De.Mul(t.camera),!1);s=Array(16).fill(0);for(ie=0;ie<4;++ie)for(se=0;se<4;++se)for(var Ne=0;Ne<4;++Ne)s[4*ie+Ne]+=Te[4*ie+se]*$e[4*se+Ne]}D&&(n.enable(n.BLEND),n.blendFunc(n.CONSTANT_ALPHA,n.ONE_MINUS_CONSTANT_ALPHA),n.blendColor(1,1,1,1-D)),c(B.color?f:h,n.TRIANGLES,x,P,[0,0,0],v,void 0,B.va),D&&n.disable(n.BLEND),B.transform&&(s=l(t.camera))}else if("number"==typeof B||$==j-1||"string"==typeof B){if(D&&(n.enable(n.BLEND),n.blendFunc(n.CONSTANT_ALPHA,n.ONE_MINUS_CONSTANT_ALPHA),n.blendColor(1,1,1,1-D)),x.length&&(c(h,n.TRIANGLES,x,P,[0,0,0],v),x.forEach(((e,t)=>{t%9==0&&(T=[0,0,0]),T[t%3]+=e/3})),x=[]),E.length){for(N=[],F=[],I=[],O=t.lineWidth||1,Z=0;Z<E.length;Z+=6)N.push(...A(E.slice(Z,Z+6))),F.push(..._(E.slice(Z,Z+6))),I.push(O,1-D,-O,1-D,O,1-D,O,1-D,-O,1-D,-O,1-D);n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.BLEND),n.depthMask(!1),c(p,n.TRIANGLES,N,[a.width/a.height,.003,0],P,a.width/a.height,I,void 0,F,!1);J=E.length-1;T=[(E[J-2]+E[J-5])/2,(E[J-1]+E[J-4])/2+.1,(E[J]+E[J-3])/2],E=[],n.depthMask(!0),n.disable(n.BLEND)}if(b.length&&(n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),c(u,n.POINTS,b,[0,0,0],P,v),(T=b.slice(-3))[0]-=.075,T[1]+=.075,b=[],n.disable(n.BLEND)),D&&n.disable(n.BLEND),"number"==typeof B&&(D=(B>>>24&255)/255,P[0]=(B>>>16&255)/255,P[1]=(B>>>8&255)/255,P[2]=(255&B)/255),"string"==typeof B)if(t.htmlText){a["_"+$]||(console.log("creating div"),Object.defineProperty(a,"_"+$,{value:document.body.appendChild(document.createElement("div")),enumerable:!1}));Me=a.getBoundingClientRect(),Ae=a["_"+$],_e=Element.Mul([[s[0],s[4],s[8],s[12]],[s[1],s[5],s[9],s[13]],[s[2],s[6],s[10],s[14]],[s[3],s[7],s[11],s[15]]],[...T,1]).map((e=>e.s));_e=Element.Mul([[5,0,0,0],[0,5*(v||2),0,0],[0,0,1,-1],[0,0,2,0]],_e).map((e=>e.s)).map(((e,t,r)=>e/r[3])),Object.assign(Ae.style,{position:"fixed",pointerEvents:"none",left:Me.left+(Me.right-Me.left)*(_e[0]/2+.5),top:Me.top+(Me.bottom-Me.top)*(-_e[1]/2+.5)-20}),Ae.last!=B&&(Ae.innerHTML=B,Ae.last=B,self.renderMathInElement&&self.renderMathInElement(Ae,{output:"html"}))}else{n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.disable(n.DEPTH_TEST);xe=113,Se=e=>{var t=e.charCodeAt(0)-33;return t>=94&&(t=94+y.indexOf(e)),t/xe};c(M,n.TRIANGLES,[...Array(6*B.length*3)].map(((e,t)=>{var r=-.2,a=0+1.1*(t/18|0);return.25*[a,-1,r,a+1.2,-1,r,a,1,r,a+1.2,-1,r,a+1.2,1,r,a,1,r][t%18]})),P,T,v,[...Array(6*B.length*2)].map(((e,t)=>{var r=Se(B[t/12|0]);return[r,1,r+1/xe,1,r,0,r+1/xe,1,r+1/xe,0,r,0][t%12]}))),n.disable(n.BLEND),T[1]-=.18,t.noZ||n.enable(n.DEPTH_TEST)}}}function Ie(e,t){var r=e[0],a=e[5],n=e[6],o=e[7],i=e[8],s=e[9],l=e[10],c=e[15];return t[2]=-2*(r*o+i*c-l*n-s*a),t[1]=-2*(i*a-r*n-l*o+s*c),t[0]=2*(r*a+i*n+s*o+l*c),t}}if(C++,document.body.contains(a)&&(C=0),2!=C)if(a.value=r,t&&!t.animate&&a.dispatchEvent(new CustomEvent("input")),a.options=t,t&&t.animate&&requestAnimationFrame(a.update.bind(a,e,t)),t&&t.still)a.value=r,a.dispatchEvent(new CustomEvent("input")),a.im.style.width=a.style.width,a.im.style.height=a.style.height,a.im.src=a.toDataURL(),(b=a.parentElement)&&(b.insertBefore(a.im,a),b.removeChild(a))}};var P=-1;if(a.oncontextmenu=a.onmousedown=n=>{if(n.preventDefault(),n.stopPropagation(),0!==n.detail){var o,i,l=a.getBoundingClientRect(),c=(n.x-l.left)/(l.right-l.left)*2-1,h=((n.y-l.top)/(l.bottom-l.top)*4-2)*a.height/a.width;P=2==n.button?-3:-2,a.value.forEach(((e,t)=>{if(5!=tot){if(e[14]){var a=Element.Mul([[s[0],s[4],s[8],s[12]],[s[1],s[5],s[9],s[13]],[s[2],s[6],s[10],s[14]],[s[3],s[7],s[11],s[15]]],[-e[13]/e[14],e[12]/e[14],e[11]/e[14],1]).map((e=>e.s));a=Element.Mul([[5,0,0,0],[0,-10,0,0],[0,0,1,-1],[0,0,2,0]],a).map((e=>e.s)).map(((e,t,r)=>e/r[3])),(c-a[0])**2+(h-a[1])**2<.01&&(P=t)}}else if(1==(e=w(e)).tp){a=Element.Mul([[s[0],s[4],s[8],s[12]],[s[1],s[5],s[9],s[13]],[s[2],s[6],s[10],s[14]],[s[3],s[7],s[11],s[15]]],[...e.pos,1]).map((e=>e.s));a=Element.Mul([[5,0,0,0],[0,5*(r||2),0,0],[0,0,1,-1],[0,0,2,0]],a).map((e=>e.s)).map(((e,t,r)=>e/r[3])),(c-a[0])**2+(-h-a[1])**2<.01&&(P=t)}})),a.onwheel=r=>{r.preventDefault(),r.stopPropagation(),t.z=(t.z||5)+r.deltaY/100,t.animate||requestAnimationFrame(a.update.bind(a,e,t))},a.onmouseup=e=>P=-1,a.onmouseleave=e=>P=-1,a.ontouchstart=e=>{e.preventDefault(),a.focus();var t=e.changedTouches[0].pageX,r=e.changedTouches[0].pageY;o=t,i=r},a.ontouchmove=function(r){r.preventDefault();var n=r.changedTouches[0].pageX,s=r.changedTouches[0].pageY,l=(n-(o||n))/1e3,c=-(s-(i||s))/1e3;o=n,i=s,t.h=(t.h||0)+l,t.p=Math.max(-Math.PI/2,Math.min(Math.PI/2,(t.p||0)+c)),t.animate||requestAnimationFrame(a.update.bind(a,e,t))},a.onmousemove=r=>{var n,o=a.getBoundingClientRect();P>=0&&(n=5==tot?w(a.value[P]):{pos:[-(n=a.value[P])[13]/n[14],-n[12]/n[14],n[11]/n[14]]});var i=r.movementX/(o.right-o.left)*2,s=r.movementY/(o.bottom-o.top)*2*a.height/a.width;if(-2==P)return t.h=(t.h||0)+(t.conformal?-1:1)*i/2,t.p=Math.max(-Math.PI/2,Math.min(Math.PI/2,(t.p||0)-s/2)),t.camera&&t.camera.set(Element.Bivector(0,0,0,0,0,t.p).Exp().Mul(Element.Bivector(0,0,0,0,t.h,0).Exp())),void(t.animate||requestAnimationFrame(a.update.bind(a,e,t)));if(-3==P){var l=Math.cos(t.h||0),c=Math.sin(t.h||0),h=Math.cos(t.p||0);Math.sin(t.p||0);return r.shiftKey?t.posy=(t.posy||0)+s:(t.posx=(t.posx||0)+i*l+s*c,t.posz=(t.posz||0)+i*-c+s*l*h),void(t.animate||requestAnimationFrame(a.update.bind(a,e,t)))}P<0||(5==tot?(n.pos[0]+=2!=r.buttons?Math.cos(t.h||0)*i:Math.sin(-(t.h||0))*-s,n.pos[1]+=2!=r.buttons?-s:0,n.pos[2]+=2!=r.buttons?Math.sin(t.h||0)*i:Math.cos(-(t.h||0))*-s,a.value[P].set(Element.Mul(x,.5*(n.pos[0]**2+n.pos[1]**2+n.pos[2]**2)).Sub(S)),a.value[P].set(n.pos,1)):n&&a.value[P].set(Element.sw(Element.sw(t.camera.Reverse,Element.Bivector(-i/2,s/2,0,0,0,0).Exp()),a.value[P])),t.animate||requestAnimationFrame(a.update.bind(a,e,t)))}}},a.value=e.call?e():e,a.options=t,t&&t.still){E=new Image;return a.im=E,requestAnimationFrame(a.update.bind(a,e,t)),a}return requestAnimationFrame(a.update.bind(a,e,t)),a}static inline(intxt){if(arguments.length>1||intxt instanceof Array){var args=[].slice.call(arguments,1);return res.inline(new Function(args.map(((e,t)=>"_template_"+t)).join(),"return ("+intxt.map(((e,t)=>(e||"")+(args[t]&&"_template_"+t||""))).join("")+")")).apply(res,args)}for(var txt=intxt instanceof Function?intxt.toString():`function(){return (${intxt})}`,tok=[],resi=[],t,possibleRegex=!1,c,tokens=[/^[\s\uFFFF]|^[\u000A\u000D\u2028\u2029]|^\/\/[^\n]*\n|^\/\*[\s\S]*?\*\//g,/^\"\"|^\'\'|^\".*?[^\\]\"|^\'.*?[^\\]\'|^\`[\s\S]*?[^\\]\`/g,/^\d+[.]{0,1}\d*[ei][\+\-_]{0,1}\d*|^\.\d+[ei][\+\-_]{0,1}\d*|^e_\d*/g,/^\d+[.]{0,1}\d*[E][+-]{0,1}\d*|^\.\d+[E][+-]{0,1}\d*|^0x\d+|^\d+[.]{0,1}\d*|^\.\d+/g,/^\/.*?[^\\]\/[gmisuy]?/g,/^(\.Normalized|\.Length|\.\.\.|>>>=|===|!==|>>>|<<=|>>=|=>|\|\||[<>\+\-\*%&|^\/!\=]=|\*\*|\+\+|\-\-|<<|>>|\&\&|\^\^|^[{}()\[\];.,<>\+\-\*%|&^!~?:=\/]{1})/g,/^[$_\p{L}][$_\p{L}\p{Mn}\p{Mc}\p{Nd}\p{Pc}\u200C\u200D]*/gu];txt.length;)for(t in tokens)if((4!=t||possibleRegex)&&(resi=txt.match(tokens[t]))){c=resi[0],0!=t&&(possibleRegex="("==c||"="==c||"["==c||","==c||";"==c),tok.push([0|t,c]),txt=txt.slice(c.length);break}tok=tok.map((e=>2==e[0]?[2,"Element.Coeff("+basis.indexOf((options.Cayley?e=>e:simplify)("e"+e[1].split(/e_|e|i/)[1]||1).replace("-",""))+","+(simplify(e[1].split(/e_|e|i/)[1]||1).match("-")?"-1*":"")+parseFloat("e"==e[1][0]?1:e[1].split(/e_|e|i/)[0])+")"]:e)),tok=tok.map((e=>1==e[0]&&"`"==e[1][0]?[1,e[1].replace(/\$\{(.*?)\}/g,(e=>"${"+Element.inline(e.slice(2,-1)).toString().match(/return \((.*)\)/)[1]+"}"))]:e));var syntax=intxt instanceof Function?[[[".Normalized","Normalize",2],[".Length","Length",2]],[["~","Conjugate",1],["!","Dual",1]],[["**","Pow",0,1]],[["^","Wedge"],["&","Vee"],["<<","LDot"]],[["*","Mul"],["/","Div"]],[["|","Dot"]],[[">>>","sw",0,1]],[["-","Sub"],["+","Add"]],[["%","%"]],[["==","eq"],["!=","neq"],["<","lt"],[">","gt"],["<=","lte"],[">=","gte"]]]:[[["pi","Math.PI"],["sin","Math.sin"]],[["ddot","this.Reverse"],["tilde","this.Involute"],["hat","this.Conjugate"],["bar","this.Dual"]],[["^","Pow",0,1]],[["^^","Wedge"],["*","LDot"]],[["**","Mul"],["/","Div"]],[["-","Sub"],["+","Add"]],[["<","lt"],[">","gt"],["<=","lte"],[">=","gte"]]];function translate(e){for(var t=(t=o-1,r=[0])=>{for(;t>=0&&~r.indexOf(e[t][0]);)t--;return t},r=(t=o+1,r=[0])=>{for(;t<e.length&&~r.indexOf(e[t][0]);)t++;return t},a=(t,r,a=6,n)=>{e.splice(t,r-t+1,[a,...n||e.slice(t,r+1)])},n=(t="(",r=")")=>{for(var a=1,n=o+1;a;)e[n][1]==t&&a++,e[n][1]==r&&a--,n++;return n-1},o=0;l=e[o];o++)"("==l[1]&&a(o,s=n(),7,[[5,"("],...translate(e.slice(o+1,s)),[5,")"]]);for(o=0;l=e[o];o++)"["==l[1]?(a(o,s=n("[","]"),7,[[5,"["],...translate(e.slice(o+1,s)),[5,"]"]]),o&&o--):"."==l[1]?(a(t(),r()),o--):7==l[0]&&o&&t()>=0&&e[t()][0]>=6&&"return"!=e[t()][1]?a(t(),o--):"new"==l[1]&&a(o,r());for(o=0;l=e[o];o++)"++"!=l[1]&&"--"!=l[1]||a(t(),o);for(o=0;l=e[o];o++)"-"==l[1]&&(t()<0||"return"==(e[t()]||[])[1]||5==(e[t()]||[5])[0])?a(o,r(),6,["Element.Sub(",e[r()],")"]):"+"==l[1]&&(t()<0||"return"==(e[t()]||[])[1]||5==(e[t()]||[0])[0]&&"."!=(e[t()]||[0])[1][0])&&a(o,o+1);for(var i,s=0;i=syntax[s];s++){var l;for(o=i[0][3]?e.length-1:0;l=e[o];i[0][3]?o--:o++)for(var c,h=0;c=i[h];h++)if(l[1]==c[0])if(2==c[2]){var m=e[t()];a(o-1,o,6,["Element."+c[1],"(",m,")"])}else if(c[2]){m=e[r()];a(o,r(),6,["Element."+c[1],"(",m,")"])}else{var u=t(),p=r(),f=e[u],d=e[p];c[0]==c[1]?a(u,p,6,[f,c[1],d]):a(u,p,6,["Element."+c[1],"(",f,",",d,")"]),o-=2}}return e}return tok=tok.map((e=>6!=e[0]?e:[].concat.apply([],syntax).filter((t=>t[0]==e[1])).length?[6,[].concat.apply([],syntax).filter((t=>t[0]==e[1]))[0][1]]:e)),eval("("+function e(t){return t.map((t=>t instanceof Array?e(t):"string"==typeof t?t:"")).join("")}(translate(tok))+")")}};2!=p&&3!=p||1!=r||(res.arrow=res.inline(((e,t,r=.03,a=.8)=>{var n=((t/=!1|-t)&(e/=!1|-e)).Length,o=[[0,r],[n-5*r,r],[n-5*r,5*a*r],[n,0],[n-5*r,5*-a*r],[n-5*r,-r],[0,-r]].map((([e,t])=>!(1+10*e+100*t)));return(1+e/!1).Normalized*(1+(t-e&!1).Normalized/0).Normalized>>>o}))),options.dual?Object.defineProperty(res.prototype,"Inverse",{configurable:!0,get(){var e=1/this.s**2;return this.map(((t,r)=>r?-t*e:1/t))}}):Object.defineProperty(res.prototype,"Inverse",{configurable:!0,get(){if(tot>5){for(var e=2**((tot+1)/2|0),t=this.Scale(1),r=1;r<e;++r){var a=t.Sub(this.constructor.Scalar(e/r*t.s));t=this.Mul(a)}return 0==t.s?0:a.Scale(1/t.s)}return 0==tot?new this.constructor.Scalar([1/this[0]]):1==tot?this.Involute.Mul(this.constructor.Scalar(1/this.Mul(this.Involute)[0])):2==tot?this.Conjugate.Mul(this.constructor.Scalar(1/this.Mul(this.Conjugate)[0])):3==tot?this.Reverse.Mul(this.Involute).Mul(this.Conjugate).Mul(this.constructor.Scalar(1/this.Mul(this.Conjugate).Mul(this.Involute).Mul(this.Reverse)[0])):4==tot?this.Conjugate.Mul(this.Mul(this.Conjugate).Map(3,4)).Mul(this.constructor.Scalar(1/this.Mul(this.Conjugate).Mul(this.Mul(this.Conjugate).Map(3,4))[0])):this.Conjugate.Mul(this.Involute).Mul(this.Reverse).Mul(this.Mul(this.Conjugate).Mul(this.Involute).Mul(this.Reverse).Map(1,4)).Mul(this.constructor.Scalar(1/this.Mul(this.Conjugate).Mul(this.Involute).Mul(this.Reverse).Mul(this.Mul(this.Conjugate).Mul(this.Involute).Mul(this.Reverse).Map(1,4))[0]))}}),options.over&&(res.over=options.over,["Mul","Add","Sub","Scale","Dot","Wedge","LDot","Vee"].forEach((e=>res.prototype[e]=options.over.inline(res.prototype[e]))),res.prototype.Coeff=function(){for(var e=0,t=arguments.length;e<t;e+=2)this[arguments[e]]=arguments[e+1]instanceof options.over?arguments[e+1]:options.over.Scalar(arguments[e+1]);return this},res.prototype.upgrade=function(){for(var e=0;e<this.length;e++)this[e]=options.over.Scalar(0)},Object.defineProperty(res.prototype,"Conjugate",{configurable:!0,get(){for(var e=new this.constructor,t=0;t<this.length;t++)e[t]=this[t].slice().Scale([1,-1,-1,1][grades[t]%4]);return e}}),Object.defineProperty(res.prototype,"Reverse",{configurable:!0,get(){for(var e=new this.constructor,t=0;t<this.length;t++)e[t]=this[t].slice().Scale([1,1,-1,-1][grades[t]%4]);return e}}),Object.defineProperty(res.prototype,"Involute",{configurable:!0,get(){for(var e=new this.constructor,t=0;t<this.length;t++)e[t]=this[t].slice().Scale([1,-1,1,-1][grades[t]%4]);return e}}),Object.defineProperty(res.prototype,"Inverse",{configurable:!0,get(){return 0==tot?new this.constructor.Scalar([this[0].Inverse]):1==tot?this.Involute.Mul(this.constructor.Scalar(this.Mul(this.Involute)[0].Inverse)):2==tot?this.Conjugate.Mul(this.constructor.Scalar(this.Mul(this.Conjugate)[0].Inverse)):3==tot?this.Reverse.Mul(this.Involute).Mul(this.Conjugate).Mul(this.constructor.Scalar(this.Mul(this.Conjugate).Mul(this.Involute).Mul(this.Reverse)[0].Inverse)):4==tot?this.Conjugate.Mul(this.Mul(this.Conjugate).Map(3,4)).Mul(this.constructor.Scalar(this.Mul(this.Conjugate).Mul(this.Mul(this.Conjugate).Map(3,4))[0].Inverse)):this.Conjugate.Mul(this.Involute).Mul(this.Reverse).Mul(this.Mul(this.Conjugate).Mul(this.Involute).Mul(this.Reverse).Map(1,4)).Mul(this.constructor.Scalar(this.Mul(this.Conjugate).Mul(this.Involute).Mul(this.Reverse).Mul(this.Mul(this.Conjugate).Mul(this.Involute).Mul(this.Reverse).Map(1,4))[0].Inverse))}}),res.prototype.toString=function(){return[...this].map(((e,t)=>0==e?void 0:t?"("+e+")"+basis[t]:e.toString())).filter((e=>e)).join(" + ")});var _D,_DT,_DA,totd=basis.length;function makeD(e=!1){return _DA=_DA||Algebra({p:p,q:q,r:r,basis:options.basis,even:options.even,over:Algebra({dual:totd})}),t=>{var r=_DA.inline(t);return(t,...a)=>{t instanceof res||(t=res.Scalar(t)),a=a.map((e=>{for(var t=_DA.Scalar(0),r=0;r<totd;r++)t[r][0]=e[r];return t}));for(var n=_DA.Scalar(0),o=0;o<totd;o++)n[o][0]=t[o],n[o][1+o]=1;var i=r(n,...a),s=[...Array(totd)].map((e=>t.slice()));if(e)for(o=0;o<totd;o++)for(var l=0;l<totd;l++)s[o][l]=i[o][l+1];else for(o=0;o<totd;o++)for(l=0;l<totd;l++)s[l][o]=i[o][l+1];return s.length<=2?s[0]:s}}}return Object.defineProperty(res,"D",{configurable:!0,get:()=>_D||(_D=makeD(!1))}),Object.defineProperty(res,"Dt",{configurable:!0,get:()=>_DT||(_DT=makeD(!0))}),res.QR=QR,fu instanceof Function?res.inline(fu)():res}}));
//# sourceMappingURL=/sm/97c95da754612fb3c335bb05b4fe78767f2308155a7476b2777d4e40a3f712c7.map
